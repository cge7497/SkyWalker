(self.webpackChunksky_walker=self.webpackChunksky_walker||[]).push([[461],{264:(e,t,s)=>{const n=s(795),a=e=>{const[t,s]=React.useState(e.players),[n,a]=React.useState(e.displayMode);React.useEffect((async()=>{if(1===n){const e=await fetch("/getPlayers"),t=await e.json();s(t)}}),[n]);const r=()=>{a(0==n?1:0)};if(!n||0===n)return React.createElement("button",{id:"playerDisplayBtn",className:" widgetBtn btn btn-light",onClick:e=>{r()}}," O -|- /\\");if(!t||0===t.length)return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:r}),React.createElement("h2",null,"No Players Yet..."));const o=t.map((e=>React.createElement("tr",{key:e.username},React.createElement("td",null,e.username),React.createElement("td",{className:"colorText",style:{backgroundColor:e.color}}))));return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:r}),React.createElement("table",null,React.createElement("caption",{className:"caption-top"},React.createElement("h3",null,React.createElement("u",null,"Current Players"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Username"),React.createElement("th",null,"Color"))),React.createElement("tbody",null,o)))},r=e=>React.createElement("div",{className:"center"},React.createElement("div",{className:"left"},React.createElement("h3",{className:"inline"},"Items"),React.createElement("img",{id:"screwattack_active",src:"assets/img/screwattack.gif",className:"noDisplay",width:"16",height:"16",alt:"Infinite Flip Powerup",title:"Space"}),React.createElement("img",{id:"screwattack_inactive",src:"assets/img/screwattack.png",className:"noDisplay",width:"16",height:"16",alt:"Infinite Flip Powerup",title:"Space"}),React.createElement("img",{id:"morphball",src:"assets/img/morphball.png",className:"noDisplay",width:"16",height:"16",alt:"Shrinking Powerup",title:"W"}),React.createElement("img",{id:"mouse",src:"assets/img/mouse.png",className:"noDisplay",width:"16",height:"16",alt:"Mouse Platform",title:"Click on game screen"}),React.createElement("img",{id:"mouse_inv",src:"assets/img/mouse_inv.png",className:"noDisplay",width:"16",height:"16",alt:"Mouse Platform",title:"Cannot use- must reload platform material."}),React.createElement("img",{id:"eyes",src:"assets/img/eyes.png",className:"noDisplay",width:"16",height:"32",alt:"Camera Shift Powerup",title:"Hold Shift. R to reset."}),React.createElement("img",{id:"yellowswitch",src:"assets/img/yellowswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Yellow Switch"}),React.createElement("img",{id:"redswitch",src:"assets/img/redswitch.png",className:"noDisplay",width:"32",height:"32",alt:"Red Switch"}),React.createElement("img",{id:"greyswitch",src:"assets/img/greyswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Grey Switch"}),React.createElement("img",{id:"arrow_l",src:"assets/img/arrow_l.png",className:"noDisplay",width:"25",height:"25",alt:"Arrow Left"}),React.createElement("img",{id:"arrow_r",src:"assets/img/arrow_r.png",className:"noDisplay",width:"25",height:"25",alt:"Arrow Right"}),React.createElement("img",{id:"stop",src:"assets/img/stop.jpg",className:"noDisplay",width:"25",height:"25",alt:"Stop"}),React.createElement("img",{id:"uni",src:"assets/img/uni.jpg",className:"noDisplay"}),React.createElement("img",{id:"door",src:"assets/img/door.png",className:"noDisplay",width:"16",height:"32",alt:"The Door"}),React.createElement("img",{id:"pipe",src:"assets/img/pipe.png",className:"noDisplay",width:"32",height:"32",alt:"The Pipe"}),React.createElement("img",{id:"theImage",src:"assets/img/theImage.png",className:"noDisplay"})),React.createElement("div",{id:"keyDiv"},React.createElement("input",{id:"theKey",placeholder:"The Key",class:"center"}),React.createElement("input",{id:"keySubmit",type:"submit",value:"Enter",class:"center"})),React.createElement("button",{id:"resetBtn",className:"btn btn-info",disabled:!0},"Back to Save"),React.createElement("select",{id:"checkpoints"}),React.createElement("br",null),React.createElement("br",null)," ",React.createElement("br",null),React.createElement("p",{className:"center",id:"instructions"},"Use '",React.createElement("strong",null,"A"),"' and '",React.createElement("strong",null,"D"),"' to move, ",React.createElement("strong",null," SPACE")," to flip.")),o=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Payment Example: "),React.createElement("input",{id:"oldPass",type:"text",name:"oldPass",placeholder:"Payment Info"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"Payment Example: "),React.createElement("input",{id:"newPass",type:"text",name:"newPass",placeholder:"Payment Info"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("input",{className:"formSubmit",id:"changePasswordSubmit",type:"submit",disabled:!0,value:"Purchase (Demo)"}))},i=async e=>{const t={shape:e,_csrf:document.getElementById("_csrf").value};ReactDOM.render(React.createElement(o,{displayMode:2}),document.getElementById("formContent")),await fetch("/setShape",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n.setShape(e)},l=e=>{const[t,s]=React.useState(e.displayMode),[n,a]=React.useState(e.disabled),[r,o]=React.useState(e.selected);React.useEffect((async()=>{a(e.disabled),o(e.selected)}),[e]);const l=()=>{s(0===t?1:0)};if(!t||0===t)return React.createElement("button",{disabled:n,id:"payModelBtn",className:"btn btn-light",onClick:l},"∇ ▢ ◇");const c=()=>React.createElement("table",{id:"payModelTable"},React.createElement("caption",{className:"caption-top"},React.createElement("h3",null,React.createElement("u",null,"Shape Shop"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Shape"),React.createElement("th",null,"Price"))),React.createElement("tbody",null,React.createElement("tr",{className:0==r?"selected":"",onClick:e=>{o(0),i(0)}},React.createElement("td",null,"Circle"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:1==r?"selected":"",onClick:e=>{o(1),i(1)}},React.createElement("td",null,React.createElement("strong",null,"Big")),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:2==r?"selected":"",onClick:e=>{o(2),i(2)}},React.createElement("td",null,"Tiny"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:3==r?"selected":"",onClick:e=>{o(3),i(3)}},React.createElement("td",null,"Spider"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:4==r?"selected":"",onClick:e=>{o(4),i(4)}},React.createElement("td",null,React.createElement("em",null,"Handsome")),React.createElement("td",null,React.createElement("em",null,"$ Free ")))));return React.createElement("div",{id:"payModelDisplay"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:l}),React.createElement(c,null))};e.exports={PlayerDisplay:a,GameInfo:r,PayModelDisplay:l,init:()=>{ReactDOM.render(React.createElement(r,null),document.getElementById("gameInfo")),ReactDOM.render(React.createElement(a,{players:[],displayMode:0}),document.getElementById("playerDisplay")),ReactDOM.render(React.createElement(l,{displayMode:0,disabled:!0,selected:0}),document.getElementById("payModel"))}}},603:e=>{const t=e=>{document.getElementById("createResponse").textContent=e};e.exports={handleError:t,sendPost:async(e,s,n)=>{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();if(document.getElementById("createResponse").textContent="",r.error)return t(r.error);r.message&&(document.getElementById("createResponse").textContent=r.message),r.redirect&&(window.location=r.redirect),n&&n(r)},hideError:()=>{document.getElementById("createResponse").textContent=""}}},689:(e,t,s)=>{"use strict";s.r(t),s.d(t,{bgRect:()=>n,clouds:()=>o,getData:()=>i,rects:()=>a,specialObjects:()=>r});class n{constructor(e,t,s,n,a){this.x=e,this.y=t,this.width=s,this.height=n,this.hSpeed=n*s/150,this.vSpeed=0,this.values={color:a}}}let a=[],r=[],o=[];const i=async()=>{const e=sessionStorage.getItem("level"),t=sessionStorage.getItem("specialObjects");sessionStorage.getItem("clouds"),e&&e.length>0&&t&&t.length>0&&(a=JSON.parse(e),r=JSON.parse(t));let s=await fetch("/getLevel",{method:"GET",headers:{Accept:"application/json"}});const n=await s.json();n.level&&(a=n.level.layers[0].entities,r=n.level.layers[1].entities,sessionStorage.setItem("level",JSON.stringify(a)),sessionStorage.setItem("specialObjects",JSON.stringify(r))),n.level.clouds&&n.level.clouds.length>0&&(o=[...n.level.clouds],sessionStorage.setItem("clouds",JSON.stringify(o)))}},316:(e,t,s)=>{const n=s(603),a=s(689),{startGameLogic:r}=s(795),o=s(264),i=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=document.querySelector("#_csrf").value;return t&&s?(n.sendPost(e.target.action,{username:t,pass:s,_csrf:a},p),!1):(n.handleError("Username or password is empty!"),!1)},l=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=e.target.querySelector("#pass2").value,r=e.target.querySelector("#colorField").value,o=document.querySelector("#_csrf").value;return t&&s&&a?s!==a?(n.handleError("Passwords do not match!"),!1):(n.sendPost(e.target.action,{username:t,pass:s,pass2:a,color:r,_csrf:o},p),!1):(n.handleError("All fields are required!"),!1)},c=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#oldPass").value,s=e.target.querySelector("#newPass").value,a=document.querySelector("#_csrf").value;return t&&s?t===s?(n.handleError("The two passwords are the same!"),!1):(n.sendPost(e.target.action,{oldPass:t,newPass:s,_csrf:a},d),!1):(n.handleError("One or more password fields are empty!"),!1)},d=e=>{e.message&&(document.getElementById("oldPass").value="",document.getElementById("newPass").value="")},u=e=>React.createElement("form",{id:"loginForm",name:"loginForm",onSubmit:i,action:"/login",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username:  "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("button",{className:"formSubmit btn btn-outline-primary btn-lg",type:"submit"},"Log In")),m=e=>React.createElement("form",{id:"signupForm",name:"signupForm",onSubmit:l,action:"/signup",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username:  "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("div",{className:"floatLeft pt-3"},React.createElement("label",{htmlFor:"colorField"},"Color: "),React.createElement("input",{id:"colorField",type:"color",name:"color",defaultValue:"#6495ed"})),React.createElement("div",{className:"floatRight pt-3"},React.createElement("label",{htmlFor:"pass2"},"Password: "),React.createElement("input",{id:"pass2",type:"password",name:"pass2",placeholder:"password"})),React.createElement("button",{className:"btn btn-outline-primary btn-lg formSubmit",type:"submit"},"Create Account")),h=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",onSubmit:c,action:"/changePassword",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Current Password: "),React.createElement("input",{id:"oldPass",type:"password",name:"oldPass",placeholder:"password"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"New Password: "),React.createElement("input",{id:"newPass",type:"password",name:"newPass",placeholder:"password"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("button",{className:"btn btn-outline-primary btn-lg formSubmit",id:"changePasswordSubmit",type:"submit"},"Set Password"))},p=(e,t)=>(r(e,t),ReactDOM.render(React.createElement(o.PayModelDisplay,{displayMode:0,disabled:!1,selected:e.shape}),document.getElementById("payModel")),document.getElementById("createResponse").textContent="Logged in as "+e.username,document.getElementById("resetBtn").disabled=!1,document.getElementById("loginButton").classList.add("hidden"),document.getElementById("signupButton").classList.add("hidden"),document.getElementById("changePasswordButton").classList.remove("hidden"),document.getElementById("logoutLink").classList.remove("hidden"),ReactDOM.render(null,document.getElementById("formContent")),!1);window.onload=async()=>{a.getData();const e=await fetch("/init"),t=await e.json();o.init();const s=document.getElementById("loginButton"),n=document.getElementById("signupButton"),r=document.getElementById("changePasswordButton");document.getElementById("_csrf").value=t.csrfToken,r.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(h,{displayMode:1}),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),t.account?(p(t.account,!0),document.getElementById("createResponse").textContent="Logged in as "+t.account.username):(s.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(u,null),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),n.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")),s.disabled=!1,n.disabled=!0,!1))),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")))}},795:(e,t,s)=>{"use strict";s.r(t),s.d(t,{setShape:()=>cs,startGameLogic:()=>_t});const n=[["#000000","#111111","#222222","#333333","#444444","#555555","#666666","#777777","#888888","#999999","#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee","#ffffff"].reverse(),["rgb(247,100,29)","rgb(235,110,29)","rgb(223,120,39)","rgb(211,130,49)","rgb(199,140,59)","rgb(187,150,69)","rgb(175,160,79)","rgb(163,170,89)","rgb(151,180,99)","rgb(139,190,109)","rgb(127,200,119)","rgb(115,210,129)","rgb(102,220,139)","rgb(90,230,149)","rgb(78,240,159)","rgb(66, 250, 169)"],["rgb(160,80,0)","rgb(150,75,10)","rgb(140,70,20)","rgb(130,65,30)","rgb(120,60,40)","rgb(110,55,50)","rgb(100,50,60)","rgb(90,45,70)","rgb(80,40,80)","rgb(70,35,90)","rgb(60,30,100)","rgb(50,25,110)","rgb(40,20,120)","rgb(30,15,130)","rgb(20,10,140)","rgb(10, 5, 150)"]],a=3*Math.PI/2,r=-Math.PI/2,o=(e,t,s,n,o=!0,i=0,l=0)=>{const c=e.x+t,d=e.y+s;switch(o&&n.clearRect(0,0,640,480),n.save(),n.translate(c,d),n.beginPath(),1===e.g&&n.rotate(Math.PI/2),e.shape){case 0:default:n.arc(0,-3*e.scale,3,r,a);break;case 1:case 2:n.arc(0,-3*e.scale,Math.abs(3*e.scale),r,a);break;case 3:n.rect(0,0,5*e.scale,5*e.scale);break;case 4:n.rect(-3*e.scale,-6*e.scale,6*e.scale,6*e.scale)}const u=(2+i)*e.scale,m=(3-l)*e.scale;n.moveTo(0,-e.scale),n.lineTo(0,5*e.scale),n.lineTo(-u,8*e.scale),n.moveTo(0,5*e.scale),n.lineTo(u,8*e.scale),n.moveTo(-3*e.scale,m),n.lineTo(0,3*e.scale),n.lineTo(3*e.scale,m),n.moveTo(0,3*e.scale),n.closePath(),e.color&&(n.strokeStyle=e.color),n.stroke(),n.restore()},i=(e,t,s,n,a,r,o=!0,i=!1,l="black")=>{a.save(),a.beginPath(),a.moveTo(e,t),a.lineTo(e+s,t),a.lineTo(e+s,t+n),a.lineTo(e,t+n),a.closePath(),i?(a.fillStyle=r,a.strokeStyle=l,a.fill(),a.stroke()):o?(a.fillStyle=r,a.fill()):(a.strokeStyle=r,a.lineWidth=3,a.stroke()),a.restore()},l=e=>(e[0]>15&&(e[0]-=.2),e[1]>31&&(e[1]-=.2),e[2]>56&&(e[2]-=.2),e);var c=s(477),d=s(689);const u=async(e,t)=>{const s={username:e,item:t,_csrf:document.querySelector("#_csrf").value};await fetch("/updateItems",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})};class m extends c.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new E(e)})),this.register((function(e){return new _(e)})),this.register((function(e){return new S(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new R(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new y(e)})),this.register((function(e){return new T(e)})),this.register((function(e){return new w(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new M(e)}))}load(e,t,s,n){const a=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:c.Zp0.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},i=new c.hH6(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(s){try{a.parse(s,r,(function(s){t(s),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let a;const r={},o={};if("string"==typeof e)a=e;else if(c.Zp0.decodeText(new Uint8Array(e,0,4))===I){try{r[p.KHR_BINARY_GLTF]=new A(e)}catch(e){return void(n&&n(e))}a=r[p.KHR_BINARY_GLTF].content}else a=c.Zp0.decodeText(new Uint8Array(e));const i=JSON.parse(a);if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Z(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);o[t.name]=t,r[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],s=i.extensionsRequired||[];switch(t){case p.KHR_MATERIALS_UNLIT:r[t]=new f;break;case p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[t]=new C;break;case p.KHR_DRACO_MESH_COMPRESSION:r[t]=new P(i,this.dracoLoader);break;case p.KHR_TEXTURE_TRANSFORM:r[t]=new L;break;case p.KHR_MESH_QUANTIZATION:r[t]=new N;break;default:s.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(s,n)}parseAsync(e,t){const s=this;return new Promise((function(n,a){s.parse(e,t,n,a)}))}}function h(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const p={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class g{constructor(e){this.parser=e,this.name=p.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const a=t.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const i=new c.Ilk(16777215);void 0!==r.color&&i.fromArray(r.color);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new c.Ox3(i),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new c.cek(i),o.distance=l;break;case"spot":o=new c.PMe(i),o.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return s._getNodeRef(t.cache,a,e)}))}}class f{constructor(){this.name=p.KHR_MATERIALS_UNLIT}getMaterialType(){return c.vBJ}extendParams(e,t,s){const n=[];e.color=new c.Ilk(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&n.push(s.assignTexture(e,"map",a.baseColorTexture,c.knz))}return Promise.all(n)}}class y{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class E{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new c.FM8(e,e)}return Promise.all(a)}}class w{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&a.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&a.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(a)}}class v{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new c.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];return void 0!==r.sheenColorFactor&&t.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&a.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,c.knz)),void 0!==r.sheenRoughnessTexture&&a.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}}class R{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&a.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class x{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&a.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=new c.Ilk(o[0],o[1],o[2]),Promise.all(a)}}class b{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class T{constructor(e){this.parser=e,this.name=p.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&a.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=new c.Ilk(o[0],o[1],o[2]),void 0!==r.specularColorTexture&&a.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,c.knz)),Promise.all(a)}}class _{constructor(e){this.parser=e,this.name=p.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,r)}}class S{constructor(e){this.parser=e,this.name=p.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],o=n.images[r.source];let i=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(i=e)}return this.detectSupport().then((function(a){if(a)return s.loadTextureImage(e,r.source,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class M{constructor(e){this.name=p.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,a.ready]).then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,i=new ArrayBuffer(r*o),l=new Uint8Array(t[0],s,n);return a.decodeGltfBuffer(new Uint8Array(i),r,o,l,e.mode,e.filter),i}))}return null}}const I="glTF";class A{constructor(e){this.name=p.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:c.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==I)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,1313821514===s){const s=new Uint8Array(e,12+a,t);this.content=c.Zp0.decodeText(s)}else if(5130562===s){const s=12+a;this.body=e.slice(s,s+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class P{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=p.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},i={},l={};for(const e in r){const t=K[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const n=K[t]||t.toLowerCase();if(void 0!==r[t]){const a=s.accessors[e.attributes[t]],r=F[a.componentType];l[n]=r,i[n]=!0===a.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=i[t];void 0!==n&&(s.normalized=n)}t(e)}),o,l)}))}))}}class L{constructor(){this.name=p.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class k extends c.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new c.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class C{constructor(){this.name=p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return k}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new c.Ilk(1,1,1),e.opacity=1;const a=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&a.push(s.assignTexture(e,"map",n.diffuseTexture,c.knz)),e.emissive=new c.Ilk(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new c.Ilk(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;a.push(s.assignTexture(e,"glossinessMap",t)),a.push(s.assignTexture(e,"specularMap",t,c.knz))}return Promise.all(a)}createMaterial(e){const t=new k(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=c.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class N{constructor(){this.name=p.KHR_MESH_QUANTIZATION}}class O extends c._C8{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let e=0;e!==n;e++)t[e]=s[a+e];return t}}O.prototype.interpolate_=function(e,t,s,n){const a=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=2*o,l=3*o,c=n-t,d=(s-t)/c,u=d*d,m=u*d,h=e*l,p=h-l,g=-2*m+3*u,f=m-u,y=1-g,E=f-u+d;for(let e=0;e!==o;e++){const t=r[p+e+o],s=r[p+e+i]*c,n=r[h+e+o],l=r[h+e]*c;a[e]=y*t+E*s+g*n+f*l}return a};const D=new c._fP;class B extends O{interpolate_(e,t,s,n){const a=super.interpolate_(e,t,s,n);return D.fromArray(a).normalize().toArray(a),a}}const F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H={9728:c.TyD,9729:c.wem,9984:c.YLQ,9985:c.qyh,9986:c.aH4,9987:c.D1R},U={33071:c.uWy,33648:c.OoA,10497:c.rpg},j={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},K={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},q={CUBICSPLINE:void 0,LINEAR:c.NMF,STEP:c.Syv};function V(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function z(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function X(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function W(e){const t=e.extensions&&e.extensions[p.KHR_DRACO_MESH_COMPRESSION];let s;return s=t?"draco:"+t.bufferView+":"+t.indices+":"+J(t.attributes):e.indices+":"+J(e.attributes)+":"+e.mode,s}function J(e){let t="";const s=Object.keys(e).sort();for(let n=0,a=s.length;n<a;n++)t+=s[n]+":"+e[s[n]]+";";return t}function Y(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Z{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new h,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,a=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||s||n&&a<98?this.textureLoader=new c.dpR(this.options.manager):this.textureLoader=new c.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new c.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};V(a,r,n),z(r,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(s[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),a=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,n]of e.children.entries())a(n,t.children[s])};return a(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&s.push(a)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[p.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){s.load(c.Zp0.resolveURL(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=j[n.type],o=F[n.componentType],i=o.BYTES_PER_ELEMENT,l=i*r,d=n.byteOffset||0,u=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,m=!0===n.normalized;let h,p;if(u&&u!==l){const e=Math.floor(d/u),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(s);l||(h=new o(a,e*u,n.count*u/i),l=new c.vpT(h,u/i),t.cache.add(s,l)),p=new c.kB5(l,r,d%u/i,m)}else h=null===a?new o(n.count*r):new o(a,d,n.count*r),p=new c.TlE(h,r,m);if(void 0!==n.sparse){const t=j.SCALAR,s=F[n.sparse.indices.componentType],i=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,d=new s(e[1],i,n.sparse.count*t),u=new o(e[2],l,n.sparse.count*r);null!==a&&(p=new c.TlE(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=d.length;e<t;e++){const t=d[e];if(p.setX(t,u[e*r]),r>=2&&p.setY(t,u[e*r+1]),r>=3&&p.setZ(t,u[e*r+2]),r>=4&&p.setW(t,u[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,a=t.images[n];let r=this.textureLoader;if(a.uri){const e=s.manager.getHandler(a.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,s){const n=this,a=this.json,r=a.textures[e],o=a.images[t],i=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[i])return this.textureCache[i];const l=this.loadImageSource(t,s).then((function(t){t.flipY=!1,r.name&&(t.name=r.name);const s=(a.samplers||{})[r.sampler]||{};return t.magFilter=H[s.magFilter]||c.wem,t.minFilter=H[s.minFilter]||c.D1R,t.wrapS=U[s.wrapS]||c.rpg,t.wrapT=U[s.wrapT]||c.rpg,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[i]=l,l}loadImageSource(e,t){const s=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const a=s.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",i=!1;if(void 0!==a.bufferView)o=this.getDependency("bufferView",a.bufferView).then((function(e){i=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(e){return new Promise((function(s,a){let r=s;!0===t.isImageBitmapLoader&&(r=function(e){const t=new c.xEZ(e);t.needsUpdate=!0,s(t)}),t.load(c.Zp0.resolveURL(e,n.path),r,void 0,a)}))})).then((function(e){var t;return!0===i&&r.revokeObjectURL(o),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,s,n){const a=this;return this.getDependency("texture",s.index).then((function(r){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),a.extensions[p.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[p.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(r);r=a.extensions[p.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),a.associations.set(r,t)}}return void 0!==n&&(r.encoding=n),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new c.UY4,c.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new c.nls,c.F5T.prototype.copy.call(t,s),t.color.copy(s.color),this.cache.add(e,t)),s=t}if(n||a||r){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return c.Wid}loadMaterial(e){const t=this,s=this.json,n=this.extensions,a=s.materials[e];let r;const o={},i=a.extensions||{},l=[];if(i[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=e.getMaterialType(),l.push(e.extendParams(o,a,t))}else if(i[p.KHR_MATERIALS_UNLIT]){const e=n[p.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),l.push(e.extendParams(o,a,t))}else{const s=a.pbrMetallicRoughness||{};if(o.color=new c.Ilk(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;o.color.fromArray(e),o.opacity=e[3]}void 0!==s.baseColorTexture&&l.push(t.assignTexture(o,"map",s.baseColorTexture,c.knz)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(l.push(t.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),l.push(t.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=c.ehD);const d=a.alphaMode||"OPAQUE";if("BLEND"===d?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===d&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==c.vBJ&&(l.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new c.FM8(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;o.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&r!==c.vBJ&&(l.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==c.vBJ&&(o.emissive=(new c.Ilk).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==c.vBJ&&l.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,c.knz)),Promise.all(l).then((function(){let s;return s=r===k?n[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),a.name&&(s.name=a.name),z(s,a),t.associations.set(s,{materials:e}),a.extensions&&V(n,s,a),s}))}createUniqueName(e){const t=c.iUV.sanitizeNodeName(e||"");let s=t;for(let e=1;this.nodeNamesUsed[s];++e)s=t+"_"+e;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function a(e){return s[p.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return Q(s,e,t)}))}const r=[];for(let s=0,o=e.length;s<o;s++){const o=e[s],i=W(o),l=n[i];if(l)r.push(l.promise);else{let e;e=o.extensions&&o.extensions[p.KHR_DRACO_MESH_COMPRESSION]?a(o):Q(new c.u9r,o,t),n[i]={primitive:o,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,a=s.meshes[e],r=a.primitives,o=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new c.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:c.Wl3})),i.DefaultMaterial):this.getDependency("material",r[e].material);o.push(t)}var i;return o.push(t.loadGeometries(r)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),i=s[s.length-1],l=[];for(let s=0,d=i.length;s<d;s++){const d=i[s],u=r[s];let m;const h=o[s];if(4===u.mode||5===u.mode||6===u.mode||void 0===u.mode)m=!0===a.isSkinnedMesh?new c.TUv(d,h):new c.Kj0(d,h),!0!==m.isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),5===u.mode?m.geometry=ee(m.geometry,c.UlW):6===u.mode&&(m.geometry=ee(m.geometry,c.z$h));else if(1===u.mode)m=new c.ejS(d,h);else if(3===u.mode)m=new c.x12(d,h);else if(2===u.mode)m=new c.blk(d,h);else{if(0!==u.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);m=new c.woe(d,h)}Object.keys(m.geometry.morphAttributes).length>0&&X(m,a),m.name=t.createUniqueName(a.name||"mesh_"+e),z(m,a),u.extensions&&V(n,m,u),t.assignFinalMaterial(m),l.push(m)}for(let s=0,n=l.length;s<n;s++)t.associations.set(l[s],{meshes:e,primitives:s});if(1===l.length)return l[0];const d=new c.ZAu;t.associations.set(d,{meshes:e});for(let e=0,t=l.length;e<t;e++)d.add(l[e]);return d}))}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?t=new c.cPb(c.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new c.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),z(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))}loadAnimation(e){const t=this.json.animations[e],s=[],n=[],a=[],r=[],o=[];for(let e=0,i=t.channels.length;e<i;e++){const i=t.channels[e],l=t.samplers[i.sampler],c=i.target,d=void 0!==c.node?c.node:c.id,u=void 0!==t.parameters?t.parameters[l.input]:l.input,m=void 0!==t.parameters?t.parameters[l.output]:l.output;s.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",u)),a.push(this.getDependency("accessor",m)),r.push(l),o.push(c)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(a),Promise.all(r),Promise.all(o)]).then((function(s){const n=s[0],a=s[1],r=s[2],o=s[3],i=s[4],l=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=a[e],d=r[e],u=o[e],m=i[e];if(void 0===t)continue;let h;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,G[m.path]){case G.weights:h=c.dUE;break;case G.rotation:h=c.iLg;break;default:h=c.yC1}const p=t.name?t.name:t.uuid,g=void 0!==u.interpolation?q[u.interpolation]:c.NMF,f=[];G[m.path]===G.weights?t.traverse((function(e){e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)})):f.push(p);let y=d.array;if(d.normalized){const e=Y(y.constructor),t=new Float32Array(y.length);for(let s=0,n=y.length;s<n;s++)t[s]=y[s]*e;y=t}for(let e=0,t=f.length;e<t;e++){const t=new h(f[e]+"."+G[m.path],s.array,y,g);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new(this instanceof c.iLg?B:O)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}const d=t.name?t.name:"animation_"+e;return new c.m7l(d,void 0,l)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,s=this.extensions,n=this,a=t.nodes[e],r=a.name?n.createUniqueName(a.name):"";return function(){const t=[],s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&t.push(s),void 0!==a.camera&&t.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===a.isBone?new c.N$j:t.length>1?new c.ZAu:1===t.length?t[0]:new c.Tme,o!==t[0])for(let e=0,s=t.length;e<s;e++)o.add(t[e]);if(a.name&&(o.userData.name=a.name,o.name=r),z(o,a),a.extensions&&V(s,o,a),void 0!==a.matrix){const e=new c.yGw;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],a=this,r=new c.ZAu;n.name&&(r.name=a.createUniqueName(n.name)),z(r,n),n.extensions&&V(s,r,n);const o=n.nodes||[],i=[];for(let e=0,s=o.length;e<s;e++)i.push($(o[e],r,t,a));return Promise.all(i).then((function(){return a.associations=(e=>{const t=new Map;for(const[e,s]of a.associations)(e instanceof c.F5T||e instanceof c.xEZ)&&t.set(e,s);return e.traverse((e=>{const s=a.associations.get(e);null!=s&&t.set(e,s)})),t})(r),r}))}}function $(e,t,s,n){const a=s.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===a.skin)return e;let t;return n.getDependency("skin",a.skin).then((function(e){t=e;const s=[];for(let e=0,a=t.joints.length;e<a;e++)s.push(n.getDependency("node",t.joints[e]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(!e.isMesh)return;const n=[],a=[];for(let e=0,r=s.length;e<r;e++){const r=s[e];if(r){n.push(r);const s=new c.yGw;void 0!==t.inverseBindMatrices&&s.fromArray(t.inverseBindMatrices.array,16*e),a.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new c.OdW(n,a),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(a.children){const t=a.children;for(let a=0,o=t.length;a<o;a++){const o=t[a];r.push($(o,e,s,n))}}return Promise.all(r)}))}function Q(e,t,s){const n=t.attributes,a=[];function r(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const s=K[t]||t.toLowerCase();s in e.attributes||a.push(r(n[t],s))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(n)}return z(e,t),function(e,t,s){const n=t.attributes,a=new c.ZzF;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new c.Pa4(t[0],t[1],t[2]),new c.Pa4(r[0],r[1],r[2])),e.normalized){const t=Y(F[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new c.Pa4,t=new c.Pa4;for(let n=0,a=r.length;n<a;n++){const a=r[n];if(void 0!==a.POSITION){const n=s.json.accessors[a.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const e=Y(F[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const o=new c.aLr;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,a=!1,r=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(a=!0),void 0!==s.COLOR_0&&(r=!0),n&&a&&r)break}if(!n&&!a&&!r)return Promise.resolve(e);const o=[],i=[],l=[];for(let c=0,d=t.length;c<d;c++){const d=t[c];if(n){const t=void 0!==d.POSITION?s.getDependency("accessor",d.POSITION):e.attributes.position;o.push(t)}if(a){const t=void 0!==d.NORMAL?s.getDependency("accessor",d.NORMAL):e.attributes.normal;i.push(t)}if(r){const t=void 0!==d.COLOR_0?s.getDependency("accessor",d.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(l)]).then((function(t){const s=t[0],o=t[1],i=t[2];return n&&(e.morphAttributes.position=s),a&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function ee(e,t){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,a=[];if(t===c.z$h)for(let e=1;e<=n;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r}let te,se,ne,ae,re,oe,ie=c.Tme,le=c.Tme,ce=c.Tme,de=c.Tme,ue=!1,me=[0,0],he=!1,pe=[],ge=[];const fe=[];let ye,Ee=[],we=!1,ve=null,Re=!1,xe=!0,be={},Te=!0,_e={},Se=[];const Me={},Ie={screwattack:{obtained:!1,collected:ws,draw:e=>{Ke(e)},collide:e=>{He(e)}},morphball:{obtained:!1,collected:ys,draw:e=>{Ke(e)},collide:e=>{He(e)}},yellowswitch:{collected:function(){const e=sfxr.generate("laserShoot");sfxr.play(e),fe.push(new d.bgRect(Math.floor(Math.random()*Rt),Math.floor(Math.random()*xt),Math.floor(10*Math.random())+30,Math.floor(4*Math.random())+10,"rgba(220,221,11,0.95)"))},draw:e=>{Ke(e)},collide:e=>{De(e)}},redswitch:{collected:function(){console.log("running>"),d.specialObjects.splice(1,2);const e=sfxr.generate("click");sfxr.play(e)},draw:e=>{Ke(e)},collide:e=>{De(e)}},greyswitch:{collected:()=>{he=!0,console.log("Hello User. Computer is ready to use in default mode."),console.log("Enter questions below...");const e=sfxr.generate("synth");sfxr.play(e)},draw:e=>{Ke(e)},collide:e=>{Be(e)}},door:{draw:e=>{Ke(e)},collide:e=>{!async function(){as=!0,ft[87]&&!os&&Ft&&(console.log("in 65"),is(),os=!0,dt=!1,await new Promise((e=>setTimeout(e,1e3))),setTimeout((()=>{dt=!0,os=!1}),1e3)),Le=!0}()}},pipe:{draw:e=>{Ke(e)},collide:e=>{Oe()}},coin:{draw:e=>{Ke(e)},collide:e=>{Oe()}},fire:{collected:ys,draw:e=>{Ae(e)},collide:e=>{Ce(e)}},mouse:{collected:Rs,draw:e=>{Ke(e)},collide:e=>{He(e)}},eyes:{collected:vs,draw:e=>{Ke(e)},collide:e=>{He(e)}},checkpoint:{draw:e=>{je(e)},collide:e=>{Fe(e)}},"3DPerson":{draw:e=>{Ue(e)}},"3DComp":{draw:e=>{Ue(e)}},arrow_l:{draw:e=>{Ke(e)},collected:e=>gs(e),collide:e=>{gs(e)}},arrow_r:{draw:e=>{Ke(e)},collected:e=>gs(e),collide:e=>{gs(e)}},stop:{draw:e=>{Ke(e)},collected:e=>fs(),collide:e=>{fs()}},"3DTree":{},"3DHouse":{}};why_cant_metroid_crawl=ys;const Ae=e=>{ns(Ge,e)&&((e,t,s,a,r,o=0)=>{r.save();let i=Math.floor(o),l=1;r.fillStyle=n[2][i],r.fillRect(e,t,s,a);for(let o=6;o>=3;o-=1){i+=l,i>14?l=-1:i<1&&(l=1),r.fillStyle=n[2][Math.floor(i)];const c=1-2/o;r.fillRect(e+s/o,t+a/o,s*c,a*c)}r.restore()})(e.x+bt,e.y+Tt,e.width,e.height,se,tt)};let Pe,Le,ke=Pe=Le=!1;const Ce=()=>{dt=!1,$e.play();const e=Ge.color;Ge.color="red",setTimeout((t=>{dt=!0,xs(),Ge.color=e}),500)};let Ne=!1;const Oe=e=>{console.log("colliding with pipe"),!Ne&&ft[83]&&(bs(),Ne=!0)},De=e=>{0!==Ge.g||!1!==Ge.flip||Ft||(d.specialObjects.splice(d.specialObjects.indexOf(e),1),Ie[e.name].collected())},Be=e=>{0!==Ge.g||!0!==Ge.flip||Ft||(d.specialObjects.splice(d.specialObjects.indexOf(e),1),Ie.greyswitch.collected())},Fe=e=>{if(!e.active){e.color="yellow",_e.active=!1,_e.color="",Ge.spawn=[e.x+e.width/2,e.y-8],_e=e;const t=sfxr.generate("explosion");sfxr.play(t)}e.active=!0,!1===Re&&Ts(!0)},He=e=>{Ie[e.name].collected(),d.specialObjects.splice(d.specialObjects.indexOf(e),1)},Ue=e=>{i(e.x+bt,e.y+Tt,25,25,se,"orange",!0),ns(Ge,e)&&(shouldDraw3DObjs=!0,ue||(ae.add(Ie[e.name].file),ue=Ie[e.name].file,me=[e.x-320,240-e.y]))},je=e=>{let t="gray";e.color&&(t=e.color);let s=1;switch(e.values.dir){case 0:default:i(e.x+bt,e.y+25+Tt,e.width,e.height-25,se,t,!1,!0);break;case 1:i(e.x+bt+25,e.y+Tt,e.width,e.height-25,se,t,!1,!0);break;case 2:i(e.x+bt,e.y-25+Tt,e.width,e.height-25,se,t,!1,!0),s=-1;break;case 3:i(e.x+bt-25,e.y+Tt,e.width,e.height-25,se,t,!1,!0)}if(e.active){const t=e.y+Tt+25*s+(e.height-25)/2;se.beginPath(),se.setLineDash([3]),se.moveTo(e.x+bt,t),se.lineTo(e.x+bt+e.width,t),se.strokeStyle="black",se.closePath(),se.stroke(),se.setLineDash([])}},Ke=(e,t=!1)=>{se.drawImage(Me[e.name],e.x+bt,e.y-e.originY+Tt)},Ge={x:1038,y:0,halfWidth:4,halfHeight:7,newX:825,newY:0,scale:1,name:"",flip:!1,g:0,spawn:[1038,200]};let qe,Ve,ze,Xe,We,Je,Ye,Ze,$e,Qe=0,et=0,tt=0,st=0,nt=0,at=3,rt=6,ot=!0,it=!1,lt=!1,ct=!1,dt=!0,ut=!1,mt=!1,ht=0,pt=!1,gt=5e3,ft=[],yt=0,Et="white",wt=[255,255,255],vt=!1;const Rt=640,xt=480;let bt=-738,Tt=100;const _t=(e,t=!1)=>{e&&e.username&&e.items&&e.color&&e.shape>=0?(Ge.name=e.username,Qe=e.color,Ge.shape=e.shape,what_is_my_name="uh... "+e.username):console.error("Did not receive player data."),be.name=Ge.name,be.color=Qe,be.movement=[],emptyMemory=bs,Ee=d.rects;let s,n,a=!0;s=Math.floor(Math.random()*d.rects.length),n=d.rects[s].values.color,ge.push(n);for(let e=0;e<10;e++){for(a=!0;a;)s=Math.floor(Math.random()*d.rects.length),n=d.rects[s].values.color,n!==ge[e]&&(a=!1);ge.push(n)}e.items&&ls(e.items),Xe=new Audio("assets/sound/buttonClick.wav"),We=new Audio("assets/sound/itemGet.wav"),We=new Audio("assets/sound/itemGet.wav"),$e=new Audio("assets/sound/explosion.wav"),Je=new Audio("assets/sound/the-earth.mp3"),Je.volume=.25,Ye=new Audio("assets/sound/warp-whistle.mp3"),Ye.volume=.3,Ze=new Audio("assets/sound/world-sky.mp3"),Ze.volume=.25,t?document.addEventListener("click",(e=>{Je.loop=!0}),{once:!0}):Je.loop=!0;let r=document.querySelector("#canvas_player"),o=document.querySelector("#canvas_walkers"),i=document.querySelector("#canvas_bg"),l=document.querySelector("#canvas_js3");document.getElementById("resetBtn").onmousedown=e=>{e.preventDefault(),xs()},document.getElementById("screwattack_active").onmousedown=e=>{u(!0)},document.getElementById("screwattack_inactive").onmousedown=e=>{u(!1)};const u=e=>{!0===Es?(document.getElementById("screwattack_active").classList.remove("noDisplay"),document.getElementById("screwattack_active").classList.add("inline"),document.getElementById("screwattack_inactive").classList.remove("inline"),document.getElementById("screwattack_inactive").classList.add("noDisplay")):(document.getElementById("screwattack_inactive").classList.remove("noDisplay"),document.getElementById("screwattack_inactive").classList.add("inline"),document.getElementById("screwattack_active").classList.remove("inline"),document.getElementById("screwattack_active").classList.add("noDisplay"))};te=o.getContext("2d"),se=r.getContext("2d"),ne=i.getContext("2d"),ae=new c.xsS,oe=new c.cPb(40,1.3333333333333333,.1,1e3),oe.position.set(0,0,10),oe.lookAt(0,0,0),re=new c.CP7({canvas:l,alpha:!0}),re.setClearColor(0,0),ye=new c.Mig(16777215),ae.add(ye);const h=new c.Ox3(16777215,.5);ae.add(h),oe.position.z=100;const p=new m;p.load("assets/img/character.glb",(function(e){ie=e.scene,ie.scale.x=ie.scale.y=ie.scale.z=1,e.scene.name="3DPerson",Ie["3DPerson"].file=e.scene}),void 0,(function(e){console.error(e)}));let g="assets/img/SavePc.glb";navigator.userAgent.match(/firefox|fxios/i)&&(g="assets/img/SavePc_f.glb"),p.load(g,(function(e){le=e.scene,le.scale.x=le.scale.y=le.scale.z=9,le.rotation.y=Math.PI,e.scene.name="3DComp",Ie["3DComp"].file=e.scene,le.position.y-=30}),void 0,(function(e){console.error(e)})),p.load("assets/img/Tree.gltf",(function(e){ce=e.scene,ce.scale.x=ce.scale.y=ce.scale.z=5,ce.rotation.y=Math.PI,console.log(ce),e.scene.name="3DTree",Ie["3DTree"].file=e.scene,ce.position.y-=30}),void 0,(function(e){console.error(e)})),p.load("assets/img/House.gltf",(function(e){de=e.scene,de.scale.x=de.scale.y=de.scale.z=9,de.rotation.y=Math.PI,e.scene.name="3DHouse",Ie["3DHouse"].file=e.scene,de.position.y-=30}),void 0,(function(e){console.error(e)})),Ve=o.width,ze=o.height,document.addEventListener("keydown",_s),document.addEventListener("keyup",Ss),r.addEventListener("contextmenu",(e=>{e.preventDefault()})),r.addEventListener("wheel",(e=>{e.preventDefault()})),d.clouds&&d.clouds.length>0&&d.clouds.forEach((e=>{fe.push(new d.bgRect(630*Math.random()+5,470*Math.random()+5,10*Math.random()+30,4*Math.random()+3,e))}));for(let e=0;e<10;e++)fe.push(new d.bgRect(Math.floor(Math.random()*Rt),Math.floor(Math.random()*xt),Math.floor(10*Math.random())+30,Math.floor(4*Math.random())+10,"rgba(0,0,0,0.3)"));d.specialObjects.forEach((e=>{"checkpoint"===e.name&&Se.push(e)})),Se.sort(((e,t)=>e.x-t.x));const f=document.getElementById("checkpoints");f.onchange=e=>{Fe(Se[f.selectedIndex]),xs()},Se.forEach(((e,t)=>{const s=document.createElement("option");s.textContent=`x: ${e.x}  y: ${e.y}`,s.value=t,f.appendChild(s)})),$t(),document.getElementById("keySubmit").onclick=jt,document.getElementById("theKey").onchange=()=>{document.getElementById("keySubmit").disabled=!1},te.fillStyle="black",It=new c.vBJ({color:Qe}),At=new c.Kj0(Mt,It),console.log(It),console.log(At.color),requestAnimationFrame(Ot),requestAnimationFrame($t)},St=(new c.iMs,new c.FM8),Mt=new c.xo$(8,8,16);let It,At,Pt=!1;const Lt=(e=!0)=>{if(e)re.setViewport(me[0]+bt,me[1]-Tt,Rt,xt);else{re.setViewport(0,0,Rt,xt),St.x=4*qe.x-1280,St.y=4*-qe.y+960;const e=new c.Pa4(St.x,St.y,-1).unproject(oe);if(e.z=1,At.position.set(e.x,e.y,e.z),ae.add(At),Pt)Ct();else{const e=(new c.ZzF).setFromObject(ce);(new c.ZzF).setFromObject(At).intersectsBox(e)&&(Pt=!0)}}he&&(le.rotation.y>=0?le.rotation.y-=.01:he=!1),re.render(ae,oe)};let kt=!1;const Ct=()=>{ce.scale.x>=15&&!kt&&(kt=!0),kt?Dt(ce):(ce.scale.x*=1.01,ce.scale.y*=1.01,ce.position.y-=.1,ce.scale.z*=1.01)};let Nt=-1;const Ot=e=>{requestAnimationFrame(Ot),e-Nt<8.333333333333334||(Nt=e,!ct&&dt?(Ht(),se.clearRect(0,0,640,480),Ut(),o(Ge,bt,Tt,se,!1,st,nt),pt&&(gt-=17,gt>0?Ge.flip?i(Ge.x-16+bt,Ge.y-12+Tt,8,gt/200,se,"orange",!1,!0):i(Ge.x+10+bt,Ge.y-12+Tt,8,gt/200,se,"orange",!1,!0):fs())):ct&&(bs(),dt&&(Bt(),se.fillStyle="black",se.clearRect(0,0,640,480),se.save(),se.scale(2,2),se.drawImage(Me.uni,-320+bt,-240+Tt),se.restore(),Lt(!1),hs(!1,!0),((e,t,s,n,o)=>{t.save(),t.translate(e.x,e.y),t.rotate(e.dirRad),t.beginPath(),t.arc(0,-3*e.scale,Math.abs(3*e.scale),r,a);const i=(3-n)*e.scale,l=(2+o)*e.scale;t.moveTo(0,-e.scale),t.lineTo(0,5*e.scale),t.lineTo(-l,8*e.scale),t.moveTo(0,5*e.scale),t.lineTo(l,8*e.scale),t.moveTo(-3*e.scale,i),t.lineTo(0,3*e.scale),t.lineTo(3*e.scale,i),t.moveTo(0,3*e.scale),t.closePath(),e.color&&(t.strokeStyle=e.color),t.lineWidth=2,t.setLineDash([1,5]),t.lineDashOffset=10*Math.random(),t.stroke(),t.restore()})(qe,se,0,nt,st))))},Dt=(e=c.Tme)=>{ft[65]&&(e.rotation.y+=.01),ft[68]&&(e.rotation.y-=.01),ft[87]&&(e.rotation.x-=.01),ft[83]&&(e.rotation.x+=.01),ft[82]&&(e.rotation.x=0,e.rotation.y=Math.PI,e.scale.x=15,e.scale.y=15,e.scale.z=15,e.position.y=-20),ft[32]&&(e.scale.x/=1.01,e.scale.y/=1.01,e.position.y+=.05,e.scale.z/=1.01),ft[16]&&(e.scale.x*=1.01,e.scale.y*=1.01,e.position.y-=.05,e.scale.z*=1.01)},Bt=()=>{ft[65]&&(qe.dirRad+=.01),ft[68]&&(qe.dirRad-=.01),qe.hSpeed=3*Math.cos(qe.dirRad),qe.vSpeed=3*Math.sin(qe.dirRad),qe.x+=qe.hSpeed/2,qe.y+=qe.vSpeed/2,qe.x>Ve+20?qe.x=-20:qe.x<-20&&(qe.x=Ve+20),qe.y>ze+20?qe.y=-20:qe.y<-20&&(qe.y=ze+20),bt-=qe.hSpeed/5,Tt-=qe.vSpeed/5,(kt&&bt>-1500&&bt<250||Tt>-1500&&Tt<250)&&(kt=!1)};let Ft=!1;const Ht=()=>{let e=0,t=0,s=!1;lt&&ft[16]?(ft[65]&&(bt+=3),ft[68]&&(bt-=3),ft[87]&&(Tt+=3),ft[83]&&(Tt-=3)):0===Ge.g?(ft[65]&&(e=-at,s=!0),ft[68]&&(e=at,s=!0),t=Ge.flip?-rt:rt):1===Ge.g&&(ft[87]&&(t=-at,s=!0),ft[83]&&(t=at,s=!0),e=Ge.flip?rt:-rt),lt&&ft[82]&&(bt=300-Ge.x,Tt=300-Ge.y),ut?(0===Ge.g&&ft[87]||1===Ge.g&&ft[68])&&(Tt-=((e,t)=>{let s=4,n=0;return t&&(s=-4),1===e.scale?(e.scale=.1,e.halfWidth=1,e.halfHeight=1,n=-s):(e.scale=1,e.halfWidth=4,e.halfHeight=7,n=-3*s),e.y+=n,n})(Ge,Ge.flip),ut=!1,ht=30,e=0,t=0):mt&&(ht-=1,ht<=0&&(ut=!0)),Ge.newX=Ge.x+e,Ge.newY=Ge.y+t;let n=ts(Ge,e,t);if(n[0]?(we||(bt+=Ge.x-Ge.newX,Tt+=Ge.y-Ge.newY),Ge.x=Ge.newX,Ge.y=Ge.newY):(Ge.x+=e,Ge.y+=t,we||(bt-=e,Tt-=t)),we&&(Ge.x+bt>Ve+20?Ge.x-=Ve+20:Ge.x+bt<-20&&(Ge.x+=Ve+20),Ge.y+Tt>ze+20?Ge.y-=ze+20:Ge.y+Tt<-20&&(Ge.y+=ze+20),!1===Ft&&!0===n[1])){const e=sfxr.generate("click");e.sound_vol=.1,sfxr.play(e)}!0===n[1]&&!1===Re&&Ts(!0),Ft=n[1],hs(s,n[1]),rs(Ge)},Ut=()=>{d.rects.forEach((e=>{i(e.x+bt,e.y+Tt,e.width,e.height,se,e.values.color,xe,!1)}));let e=!1;d.specialObjects.forEach((t=>{"3D"===t.name.substring(0,2)?(i(t.x+bt,t.y+Tt,t.width,t.height,se,"orange",!1),ns(Ge,t)&&(e=!0,ue!==t.name&&(ae.remove(ue),ue=!1),!ue&&Ie[t.name].file&&(ae.add(Ie[t.name].file),ue=Ie[t.name].file,me=[t.x-320,240-t.y]))):Ie[t.name].draw(t)})),e?Lt():!1!==ue&&(ae.remove(ue),ue=!1),null!==ve&&(ve.x+=ve.hSpeed,i(ve.x+bt,ve.y+Tt,ve.width,ve.height,se,ve.values.color,!1,!0),ve.x+bt>Ve+20&&(ve.x-=Ve+80)),Qt&&(se.globalAlpha=0,se.drawImage(Me.theImage,0,0),Jt=setInterval((()=>{se.clearRect(0,0,Rt,xt);const e=Math.sin(Wt);se.globalAlpha=e,se.drawImage(Me.theImage,0,0),e>.8&&(Gt=!0),Gt&&zt(),Wt+=Xt}),100),dt=!1,setTimeout((()=>{dt=!0,clearInterval(Jt),document.getElementById("keyDiv").hidden=!1,Gt=!1,Qt=!1,se.globalAlpha=1,setTimeout((()=>{es=!0}),2e3)}),1e4))},jt=async()=>{document.getElementById("keySubmit").disabled=!0,console.log("evaluate the key");!0===(async e=>{const t={key:document.getElementById("theKey").value,_csrf:document.querySelector("#_csrf").value};return 200===(await fetch("/enterKey",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)})).status})()&&console.log("correct")};let Kt=0,Gt=!1,qt=!1,Vt=!1;const zt=()=>{const e=Math.sin(Kt);if(Kt>=1){if(document.getElementById("keyDiv").hidden=!1,qt&&!Vt){const e=sfxr.generate("powerUp");sfxr.play(e),Vt=!0}else document.getElementById("keySubmit").onclick=jt,document.getElementById("theKey").onchange=()=>{document.getElementById("keySubmit").disabled=!1};qt=!0}se.save(),se.globalAlpha=e,se.fillStyle="Aqua",se.beginPath(),se.arc(120,100,10,0,2*Math.PI),se.closePath(),se.fill(),se.beginPath(),se.arc(160,100,10,0,2*Math.PI),se.closePath(),se.fill(),se.restore(),se.save(),se.strokeStyle="rgba(0, 255, 255, "+e-.4+")",se.beginPath(),se.strokeWidth=5,se.moveTo(120,100),se.lineTo(350,480),se.closePath(),se.stroke(),se.beginPath(),se.moveTo(160,100),se.lineTo(350,480),se.closePath(),se.stroke(),se.restore(),Kt+=.05},Xt=Math.PI/100;let Wt=0,Jt=0,Yt=.4,Zt=-1;const $t=e=>{requestAnimationFrame($t),e-Zt<66.66666666666667||(Zt=e,ne.clearRect(0,0,Rt,xt),tt+=Yt,tt>14.5?Yt=-2:tt<.5&&(Yt=2),vt&&(wt=l(wt),Et="rgb("+wt[0]+","+wt[1]+","+wt[2]+")"),i(0,0,Ve,ze,ne,Et,!0),yt+=0,fe.forEach((function(e){e.x+=e.hSpeed,e.y+=e.vSpeed,Te&&(e.x>Ve+20?e.x=-20:e.x<-20&&(e.x=Ve+20),e.y>ze+20?e.y=-20:e.y<-20&&(e.y=ze+20)),i(e.x,e.y,e.width,e.height,ne,e.values.color,!0)})))};let Qt=!1,es=!1;const ts=(e,t,s)=>{let n=e,a=[!1,!1];Qt=!1,!0===we&&(n={...e},n.x+=bt,n.y+=Tt,n.newX+=bt,n.newY+=Tt);let r=new c.Ilk,o=!1;return Ee.forEach((i=>{if(ss(n,i)){if(a[0]=!0,i.values&&i.values.color&&i.values.color!==pe[pe.length-1]){if(o=!0,ms>=60){const e=Math.floor(ms/60-1)%(ge.length-1);r.lerpColors(ye.color,ge[e].toLowerCase(),ms%120/120)}else r=new c.Ilk(i.values.color.toLowerCase());pe.length>0&&i.values.color===ge[pe.length-1]&&(pe.push(i.values.color),pe.length===ge.length&&console.log("COMPLETE"))}i.values&&"rgba(220,221,11,0.95)"===i.values.color&&(console.log(es),1==es?(Fe(Se[8]),xs(),is()):Qt=!0),((e,t)=>e.y+(e.halfHeight-1)<t.y&&e.newY+(e.halfHeight+1)>=t.y)(n,i)||((e,t)=>e.y-(e.halfHeight-2)>=t.y+t.height&&e.newY-(e.halfHeight+2)<t.y+t.height)(n,i)?(e.newY-=s,0===n.g&&(ot=!0,i.isPlayerRect?e.newX+=ve.hSpeed:a[1]=!0)):(((e,t)=>e.x-(e.halfWidth-2)>=t.x+t.width&&e.newX-(e.halfWidth+2)<t.x+t.width)(n,i)||((e,t)=>e.x+(e.halfWidth-2)<=t.x&&e.newX+(e.halfWidth+2)>=t.x)(n,i))&&(e.newX-=t,1===n.g&&(ot=!0,i.isPlayerRect||(a[1]=!0)))}})),(ms>=60||o)&&(ye.color=r),a},ss=(e,t)=>e.newX-e.halfWidth<t.x+t.width&&e.newX+e.halfWidth>t.x&&e.newY-e.halfHeight<t.y+t.height&&e.newY+e.halfHeight>t.y,ns=(e,t)=>e.newX-e.halfWidth<t.x+t.width+400&&e.newX+e.halfWidth>t.x-400&&e.newY-e.halfHeight<t.y+t.height+500&&e.newY+e.halfHeight>t.y-500;let as=!1;const rs=e=>{ke=!1,as=!1,d.specialObjects.forEach((t=>{if(ss(e,t)&&"3D"!==t.name.substring(0,2)&&Ie[t.name].collide(t),ve&&("arrow"===t.name.substring(0,5)||"stop"===t.name)&&ve.x-ve.width<t.x+t.width/2&&ve.x+ve.width>t.x-t.width/2&&ve.y-ve.height<t.y+t.height/2&&ve.y+ve.height>t.y-t.height/2&&t.values&&null!==t.values.dir)if(3===t.values.dir){if(-2!==ve.hSpeed){ve.hSpeed=-2;const e=sfxr.generate("click");sfxr.play(e)}}else if(1===t.values.dir){if(2!==ve.hSpeed){ve.hSpeed=2;const e=sfxr.generate("click");sfxr.play(e)}}else if(5===t.values.dir&&0!==ve.hSpeed){ve.hSpeed=0;const e=sfxr.generate("click");sfxr.play(e)}}))};let os=!1;function is(){let e=Params.prototype.fromJSON({oldParams:!0,wave_type:0,p_env_attack:-3653593375929631e-20,p_env_sustain:.5159887075424194,p_env_punch:.43771442770957947,p_env_decay:-.5177679657936096,p_base_freq:.4211834669113159,p_freq_limit:0,p_freq_ramp:.09771327674388885,p_freq_dramp:.18222975730895996,p_vib_strength:.29777976870536804,p_vib_speed:.8540940284729004,p_arp_mod:.3622890114784241,p_arp_speed:-.032950595021247864,p_duty:-.44415274262428284,p_duty_ramp:-.6385311484336853,p_repeat_speed:.07904504984617233,p_pha_offset:.050250060856342316,p_pha_ramp:.3983093798160553,p_lpf_freq:.5602583885192871,p_lpf_ramp:-.0018845867598429322,p_lpf_resonance:-.17684580385684967,p_hpf_freq:2.0634999486901506e-8,p_hpf_ramp:.11631236225366592,sound_vol:.25,sample_rate:44100,sample_size:8});e.mutate(),sfxr.toAudio(e).play(),we=!we,!0===we?(Ee=fe,xe=!1,at=1,rt=2):(Ee=d.rects,xe=!0,at=3,rt=6)}const ls=e=>{Me.screwattack=document.getElementById("screwattack_inactive"),Me.morphball=document.getElementById("morphball"),Me.greyswitch=document.getElementById("greyswitch"),Me.yellowswitch=document.getElementById("yellowswitch"),Me.redswitch=document.getElementById("redswitch"),Me.door=document.getElementById("door"),Me.uni=document.getElementById("uni"),Me.mouse=document.getElementById("mouse"),Me.eyes=document.getElementById("eyes"),Me.arrow_l=document.getElementById("arrow_l"),Me.arrow_r=document.getElementById("arrow_r"),Me.stop=document.getElementById("stop"),Me.pipe=document.getElementById("pipe"),Me.coin=document.getElementById("pipe"),Me.theImage=document.getElementById("theImage"),!0===e.morphball&&ys(!1),!0===e.screwattack&&ws(!1),!0===e.mouse&&Rs(!1),!0===e.eyes&&vs(!1)},cs=(e=0)=>{Ge.shape=e,Ge.scale=1===e?2:2===e?.5:1};let ds=!0,us=!0,ms=0;const hs=(e=!1,t=!1)=>{e&&t?(ms=0,ds?(st+=.25,st>=2&&(ds=!1)):(st-=.25,st<=-2&&(ds=!0))):0!==st&&(st=0),t?0!==nt&&(nt=0):(ms+=1,us?(nt+=.4,nt>=2&&(us=!1)):(nt-=.4,nt<=-2&&(us=!0)))};let ps=!0;function gs(e){if(e.values&&1===e.values.dir?(Ge.g=1,Ge.flip=!0,Ge.scale=-1*Math.abs(Ge.scale)):(Ge.g=1,Ge.flip=!1,Ge.scale=Math.abs(Ge.scale)),Ge.halfHeight=4,Ge.halfWidth=7,pt=!0,gt=5e3,ps){const e=sfxr.generate("powerUp");sfxr.play(e),ps=!1,setTimeout((()=>{ps=!0}),100)}}function fs(){const e=sfxr.generate("jump");e.sound_vol=.05,sfxr.play(e),Ge.g=0,Ge.halfWidth=4,Ge.halfHeight=7,Ge.flip=!1,Ge.scale=Math.abs(Ge.scale),pt=!1}function ys(e=!0){mt='User- you must put parentheses "()" after a function\'s name to execute it.',document.getElementById("morphball").classList.remove("noDisplay"),document.getElementById("morphball").classList.add("inline"),ut=!0,mt=!0,!0===e&&(u(Ge.name,"morphball"),We.play())}let Es=!1;function ws(e=!0){document.getElementById("screwattack_active").classList.remove("noDisplay"),document.getElementById("screwattack_active").classList.add("inline"),Es=!0,!0===e&&(u(Ge.name,"screwattack"),We.play())}function vs(e=!0){document.getElementById("eyes").classList.remove("noDisplay"),document.getElementById("eyes").classList.add("inline"),lt=!0,!0===e&&(u(Ge.name,"eyes"),We.play())}function Rs(e=!0){document.getElementById("mouse").classList.remove("noDisplay"),document.getElementById("mouse").classList.add("inline"),console.log("By the way, you can mouse over an item to see a short description."),it=!0,Re=!0,document.body.addEventListener("mousedown",(e=>{if(!Re)return;const t=(e=>{let t,s,n;return"canvas"!=e.target.localName?(console.log("not on canvas (utilities 160)"),null):(n=Math.floor(2*Math.random()),t=e.layerX-25,s=e.layerY-10,[t,s])})(e);if(null!==t){Ts(!1);const e=sfxr.generate("click");e.sound_vol=.1,sfxr.play(e),null==ve?(ve=new d.bgRect(t[0]-bt,t[1]-Tt,50,20,Qe),ve.values={color:Qe},ve.hSpeed=2,ve.isPlayerRect=!0,Ee.push(ve)):(ve.x=t[0]-bt,ve.y=t[1]-Tt)}})),!0===e&&(u(Ge.name,"mouse"),We.play())}const xs=()=>{Ge.x=Ge.spawn[0],Ge.y=Ge.spawn[1],0===Ge.g&&(Ge.flip=!1),Ge.scale=Math.abs(Ge.scale),Ge.newX=300,Ge.newY=300,bt=300-Ge.x,Tt=300-Ge.y,(async e=>{let t=await fetch("/..."+e+"...",{method:"GET",headers:{Accept:"image/*"}}),s=await t.json();switch(t.status){case 200:case 204:break;default:console.error(s)}})(Ge.name)};function bs(){ct||(dt=!1,qe=new d.bgRect(Ge.x,-20,10*Math.random()+30,4*Math.random()+3,Qe),qe.dirRad=-Math.PI/2,qe.halfWidth=qe.width/2,qe.halfHeight=qe.height/2,qe.scale=3,ae.add(Ie["3DTree"].file),Je.pause(),Ye.play(),document.getElementById("resetBtn").disabled=!0,setTimeout((()=>{Ze.play(),dt=!0,Te=!1,se.filter="none",Ze.addEventListener("timeupdate",(e=>{Ze.currentTime>Ze.duration-.12&&(Ze.currentTime=0,Ze.play())}))}),6e3),vt=!0,ct=!0),dt||(et<254&&(et+=.15,Ge.y+=.3),o(Ge,bt,Tt,se,!0,0,0),wt=l(wt),se.filter=`grayscale(${10*et}%) blur(${et/2}px)`,Ut())}const Ts=e=>{!0===it&&(!0===e?(document.getElementById("mouse").classList.remove("noDisplay"),document.getElementById("mouse").classList.add("inline"),document.getElementById("mouse_inv").classList.remove("inline"),document.getElementById("mouse_inv").classList.add("noDisplay"),Re=!0):(document.getElementById("mouse_inv").classList.remove("noDisplay"),document.getElementById("mouse_inv").classList.add("inline"),document.getElementById("mouse").classList.remove("inline"),document.getElementById("mouse").classList.add("noDisplay"),Re=!1))},_s=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:ft[e.keyCode]=!0;break;case 32:if(e.preventDefault(),!ft[e.keyCode]&&ot){Ge.flip=!Ge.flip,Ge.scale*=-1,ot=!1;const e=sfxr.generate("jump");e.sound_vol=.1,sfxr.play(e)}ft[e.keyCode]=!0}},Ss=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:case 32:ft[e.keyCode]=!1}}}},e=>{e(e.s=316)}]);