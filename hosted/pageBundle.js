(self.webpackChunksky_walker=self.webpackChunksky_walker||[]).push([[768],{264:(e,t,s)=>{const n=s(795),a=e=>{const[t,s]=React.useState(e.players),[n,a]=React.useState(e.displayMode);React.useEffect((async()=>{if(1===n){const e=await fetch("/getPlayers"),t=await e.json();s(t)}}),[n]);const r=()=>{a(0==n?1:0)};if(!n||0===n)return React.createElement("button",{id:"playerDisplayBtn",className:" widgetBtn btn btn-light",onClick:e=>{r()}}," O -|- /\\");if(!t||0===t.length)return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:r}),React.createElement("h2",null,"No Players Yet..."));const o=t.map((e=>React.createElement("tr",{key:e.username},React.createElement("td",null,e.username),React.createElement("td",{className:"colorText",style:{backgroundColor:e.color}}))));return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:r}),React.createElement("table",null,React.createElement("caption",{className:"caption-top"},React.createElement("h3",null,React.createElement("u",null,"Current Players"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Username"),React.createElement("th",null,"Color"))),React.createElement("tbody",null,o)))},r=e=>React.createElement("div",{className:"center"},React.createElement("div",{className:"left"},React.createElement("h3",{className:"inline"},"Items"),React.createElement("img",{id:"screwattack_active",src:"assets/img/screwattack.gif",className:"noDisplay",width:"16",height:"16",alt:"Infinite Flip Powerup",title:"Space"}),React.createElement("img",{id:"screwattack_inactive",src:"assets/img/screwattack.png",className:"noDisplay",width:"16",height:"16",alt:"Infinite Flip Powerup",title:"Space"}),React.createElement("img",{id:"morphball",src:"assets/img/morphball.png",className:"noDisplay",width:"16",height:"16",alt:"Shrinking Powerup",title:"W"}),React.createElement("img",{id:"mouse",src:"assets/img/mouse.png",className:"noDisplay",width:"16",height:"16",alt:"Mouse Platform",title:"Click on game screen"}),React.createElement("img",{id:"mouse_inv",src:"assets/img/mouse_inv.png",className:"noDisplay",width:"16",height:"16",alt:"Mouse Platform",title:"Cannot use- must reload platform material."}),React.createElement("img",{id:"eyes",src:"assets/img/eyes.png",className:"noDisplay",width:"16",height:"32",alt:"Camera Shift Powerup",title:"Hold Shift. R to reset."}),React.createElement("img",{id:"yellowswitch",src:"assets/img/yellowswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Yellow Switch"}),React.createElement("img",{id:"redswitch",src:"assets/img/redswitch.png",className:"noDisplay",width:"32",height:"32",alt:"Red Switch"}),React.createElement("img",{id:"greyswitch",src:"assets/img/greyswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Grey Switch"}),React.createElement("img",{id:"hflip",src:"assets/img/hflip.png",className:"noDisplay",width:"25",height:"25",alt:"Arrow Right"}),React.createElement("img",{id:"uni",src:"assets/img/uni.jpg",className:"noDisplay"}),React.createElement("img",{id:"door",src:"assets/img/door.png",className:"noDisplay",width:"16",height:"32",alt:"The Door"}),React.createElement("img",{id:"theImage",src:"assets/img/theImage.png",className:"noDisplay"})),React.createElement("input",{hidden:!0,id:"theGood",placeholder:"The Key",class:"d-inline center"}),React.createElement("button",{id:"resetBtn",className:"btn btn-info",disabled:!0},"Back to Save"),React.createElement("br",null),React.createElement("br",null)," ",React.createElement("br",null),React.createElement("p",{className:"center",id:"instructions"},"Use '",React.createElement("strong",null,"A"),"' and '",React.createElement("strong",null,"D"),"' to move, ",React.createElement("strong",null," SPACE")," to flip.")),o=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Payment Example: "),React.createElement("input",{id:"oldPass",type:"text",name:"oldPass",placeholder:"Payment Info"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"Payment Example: "),React.createElement("input",{id:"newPass",type:"text",name:"newPass",placeholder:"Payment Info"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("input",{className:"formSubmit",id:"changePasswordSubmit",type:"submit",disabled:!0,value:"Purchase (Demo)"}))},i=async e=>{const t={shape:e,_csrf:document.getElementById("_csrf").value};ReactDOM.render(React.createElement(o,{displayMode:2}),document.getElementById("formContent")),await fetch("/setShape",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n.setShape(e)},l=e=>{const[t,s]=React.useState(e.displayMode),[n,a]=React.useState(e.disabled),[r,o]=React.useState(e.selected);React.useEffect((async()=>{a(e.disabled),o(e.selected)}),[e]);const l=()=>{s(0===t?1:0)};if(!t||0===t)return React.createElement("button",{disabled:n,id:"payModelBtn",className:"btn btn-light",onClick:l},"∇ ▢ ◇");const c=()=>React.createElement("table",{id:"payModelTable"},React.createElement("caption",{className:"caption-top"},React.createElement("h3",null,React.createElement("u",null,"Shape Shop"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Shape"),React.createElement("th",null,"Price"))),React.createElement("tbody",null,React.createElement("tr",{className:0==r?"selected":"",onClick:e=>{o(0),i(0)}},React.createElement("td",null,"Circle"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:1==r?"selected":"",onClick:e=>{o(1),i(1)}},React.createElement("td",null,React.createElement("strong",null,"Big")),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:2==r?"selected":"",onClick:e=>{o(2),i(2)}},React.createElement("td",null,"Tiny"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:3==r?"selected":"",onClick:e=>{o(3),i(3)}},React.createElement("td",null,"Spider"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:4==r?"selected":"",onClick:e=>{o(4),i(4)}},React.createElement("td",null,React.createElement("em",null,"Handsome")),React.createElement("td",null,React.createElement("em",null,"$ Free ")))));return React.createElement("div",{id:"payModelDisplay"},React.createElement("button",{type:"button",className:"btn-close position-absolute end-0","aria-label":"Close",onClick:l}),React.createElement(c,null))};e.exports={PlayerDisplay:a,GameInfo:r,PayModelDisplay:l,init:()=>{ReactDOM.render(React.createElement(r,null),document.getElementById("gameInfo")),ReactDOM.render(React.createElement(a,{players:[],displayMode:0}),document.getElementById("playerDisplay")),ReactDOM.render(React.createElement(l,{displayMode:0,disabled:!0,selected:0}),document.getElementById("payModel"))}}},603:e=>{const t=e=>{document.getElementById("createResponse").textContent=e};e.exports={handleError:t,sendPost:async(e,s,n)=>{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();if(document.getElementById("createResponse").textContent="",r.error)return t(r.error);r.message&&(document.getElementById("createResponse").textContent=r.message),r.redirect&&(window.location=r.redirect),n&&n(r)},hideError:()=>{document.getElementById("createResponse").textContent=""}}},689:(e,t,s)=>{"use strict";s.r(t),s.d(t,{bgRect:()=>n,clouds:()=>o,getData:()=>i,rects:()=>a,specialObjects:()=>r});class n{constructor(e,t,s,n,a){this.x=e,this.y=t,this.width=s,this.height=n,this.hSpeed=n*s/150,this.vSpeed=0,this.values={color:a}}}let a=[],r=[],o=[];const i=async()=>{const e=sessionStorage.getItem("level"),t=sessionStorage.getItem("specialObjects");sessionStorage.getItem("clouds"),e&&e.length>0&&t&&t.length>0&&(a=JSON.parse(e),r=JSON.parse(t));let s=await fetch("/getLevel",{method:"GET",headers:{Accept:"application/json"}});const n=await s.json();n.level&&(a=n.level.layers[0].entities,r=n.level.layers[1].entities,sessionStorage.setItem("level",JSON.stringify(a)),sessionStorage.setItem("specialObjects",JSON.stringify(r))),n.level.clouds&&n.level.clouds.length>0&&(o=[...n.level.clouds],sessionStorage.setItem("clouds",JSON.stringify(o)))}},316:(e,t,s)=>{const n=s(603),a=s(689),{startGameLogic:r}=s(795),o=s(264),i=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=document.querySelector("#_csrf").value;return t&&s?(n.sendPost(e.target.action,{username:t,pass:s,_csrf:a},p),!1):(n.handleError("Username or password is empty!"),!1)},l=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=e.target.querySelector("#pass2").value,r=e.target.querySelector("#colorField").value,o=document.querySelector("#_csrf").value;return t&&s&&a?s!==a?(n.handleError("Passwords do not match!"),!1):(n.sendPost(e.target.action,{username:t,pass:s,pass2:a,color:r,_csrf:o},p),!1):(n.handleError("All fields are required!"),!1)},c=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#oldPass").value,s=e.target.querySelector("#newPass").value,a=document.querySelector("#_csrf").value;return t&&s?t===s?(n.handleError("The two passwords are the same!"),!1):(n.sendPost(e.target.action,{oldPass:t,newPass:s,_csrf:a},u),!1):(n.handleError("One or more password fields are empty!"),!1)},u=e=>{e.message&&(document.getElementById("oldPass").value="",document.getElementById("newPass").value="")},d=e=>React.createElement("form",{id:"loginForm",name:"loginForm",onSubmit:i,action:"/login",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username:  "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("button",{className:"formSubmit btn btn-outline-primary btn-lg",type:"submit"},"Log In")),m=e=>React.createElement("form",{id:"signupForm",name:"signupForm",onSubmit:l,action:"/signup",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username:  "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"colorField"},"Color: "),React.createElement("input",{id:"colorField",type:"color",name:"color",defaultValue:"#6495ed"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass2"},"Password: "),React.createElement("input",{id:"pass2",type:"password",name:"pass2",placeholder:"password"})),React.createElement("button",{className:"btn btn-outline-primary btn-lg formSubmit",type:"submit"},"Create Account")),h=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",onSubmit:c,action:"/changePassword",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Current Password: "),React.createElement("input",{id:"oldPass",type:"password",name:"oldPass",placeholder:"password"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"New Password: "),React.createElement("input",{id:"newPass",type:"password",name:"newPass",placeholder:"password"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("button",{className:"btn btn-outline-primary btn-lg formSubmit",id:"changePasswordSubmit",type:"submit"},"Set Password"))},p=(e,t)=>(r(e,t),ReactDOM.render(React.createElement(o.PayModelDisplay,{displayMode:0,disabled:!1,selected:e.shape}),document.getElementById("payModel")),document.getElementById("createResponse").textContent="Logged in as "+e.username,document.getElementById("resetBtn").disabled=!1,document.getElementById("loginButton").classList.add("hidden"),document.getElementById("signupButton").classList.add("hidden"),document.getElementById("changePasswordButton").classList.remove("hidden"),document.getElementById("logoutLink").classList.remove("hidden"),ReactDOM.render(null,document.getElementById("formContent")),!1);window.onload=async()=>{a.getData();const e=await fetch("/init"),t=await e.json();o.init();const s=document.getElementById("loginButton"),n=document.getElementById("signupButton"),r=document.getElementById("changePasswordButton");document.getElementById("_csrf").value=t.csrfToken,r.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(h,{displayMode:1}),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),t.account?(p(t.account,!0),document.getElementById("createResponse").textContent="Logged in as "+t.account.username):(s.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(d,null),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),n.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")),s.disabled=!1,n.disabled=!0,!1))),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")))}},795:(e,t,s)=>{"use strict";s.r(t),s.d(t,{setShape:()=>Kt,startGameLogic:()=>gt});const n=[["#000000","#111111","#222222","#333333","#444444","#555555","#666666","#777777","#888888","#999999","#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee","#ffffff"].reverse(),["rgb(247,100,29)","rgb(235,110,29)","rgb(223,120,39)","rgb(211,130,49)","rgb(199,140,59)","rgb(187,150,69)","rgb(175,160,79)","rgb(163,170,89)","rgb(151,180,99)","rgb(139,190,109)","rgb(127,200,119)","rgb(115,210,129)","rgb(102,220,139)","rgb(90,230,149)","rgb(78,240,159)","rgb(66, 250, 169)"],["rgb(160,80,0)","rgb(150,75,10)","rgb(140,70,20)","rgb(130,65,30)","rgb(120,60,40)","rgb(110,55,50)","rgb(100,50,60)","rgb(90,45,70)","rgb(80,40,80)","rgb(70,35,90)","rgb(60,30,100)","rgb(50,25,110)","rgb(40,20,120)","rgb(30,15,130)","rgb(20,10,140)","rgb(10, 5, 150)"]],a=3*Math.PI/2,r=-Math.PI/2,o=(e,t,s,n,o=!0,i=0,l=0)=>{const c=e.x+t,u=e.y+s;switch(o&&n.clearRect(0,0,640,480),n.save(),n.translate(c,u),n.beginPath(),1===e.g&&n.rotate(Math.PI/2),e.shape){case 0:default:n.arc(0,-3*e.scale,3,r,a);break;case 1:case 2:n.arc(0,-3*e.scale,Math.abs(3*e.scale),r,a);break;case 3:n.rect(0,0,5*e.scale,5*e.scale);break;case 4:n.rect(-3*e.scale,-6*e.scale,6*e.scale,6*e.scale)}const d=(2+i)*e.scale,m=(3-l)*e.scale;n.moveTo(0,-e.scale),n.lineTo(0,5*e.scale),n.lineTo(-d,8*e.scale),n.moveTo(0,5*e.scale),n.lineTo(d,8*e.scale),n.moveTo(-3*e.scale,m),n.lineTo(0,3*e.scale),n.lineTo(3*e.scale,m),n.moveTo(0,3*e.scale),n.closePath(),e.color&&(n.strokeStyle=e.color),n.stroke(),n.restore()},i=(e,t,s,n,a,r,o=!0,i=!1,l="black")=>{a.save(),a.beginPath(),a.moveTo(e,t),a.lineTo(e+s,t),a.lineTo(e+s,t+n),a.lineTo(e,t+n),a.closePath(),i?(a.fillStyle=r,a.strokeStyle=l,a.fill(),a.stroke()):o?(a.fillStyle=r,a.fill()):(a.strokeStyle=r,a.lineWidth=3,a.stroke()),a.restore()};var l=s(477),c=s(689);const u=async(e,t)=>{const s={username:e,item:t,_csrf:document.querySelector("#_csrf").value};await fetch("/updateItems",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})};class d extends l.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new y(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new _(e)})),this.register((function(e){return new E(e)})),this.register((function(e){return new w(e)})),this.register((function(e){return new R(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new T(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new M(e)}))}load(e,t,s,n){const a=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:l.Zp0.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},i=new l.hH6(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(s){try{a.parse(s,r,(function(s){t(s),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let a;const r={},o={};if("string"==typeof e)a=e;else if(l.Zp0.decodeText(new Uint8Array(e,0,4))===S){try{r[h.KHR_BINARY_GLTF]=new I(e)}catch(e){return void(n&&n(e))}a=r[h.KHR_BINARY_GLTF].content}else a=l.Zp0.decodeText(new Uint8Array(e));const i=JSON.parse(a);if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new Y(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);o[t.name]=t,r[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],s=i.extensionsRequired||[];switch(t){case h.KHR_MATERIALS_UNLIT:r[t]=new f;break;case h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[t]=new k;break;case h.KHR_DRACO_MESH_COMPRESSION:r[t]=new A(i,this.dracoLoader);break;case h.KHR_TEXTURE_TRANSFORM:r[t]=new L;break;case h.KHR_MESH_QUANTIZATION:r[t]=new C;break;default:s.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(r),c.setPlugins(o),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise((function(n,a){s.parse(e,t,n,a)}))}}function m(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class p{constructor(e){this.parser=e,this.name=h.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const a=t.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const i=new l.Ilk(16777215);void 0!==r.color&&i.fromArray(r.color);const c=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new l.Ox3(i),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new l.cek(i),o.distance=c;break;case"spot":o=new l.PMe(i),o.distance=c,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return s._getNodeRef(t.cache,a,e)}))}}class f{constructor(){this.name=h.KHR_MATERIALS_UNLIT}getMaterialType(){return l.vBJ}extendParams(e,t,s){const n=[];e.color=new l.Ilk(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&n.push(s.assignTexture(e,"map",a.baseColorTexture,l.knz))}return Promise.all(n)}}class g{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class y{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.FM8(e,e)}return Promise.all(a)}}class v{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&a.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&a.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(a)}}class E{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new l.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];return void 0!==r.sheenColorFactor&&t.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&a.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,l.knz)),void 0!==r.sheenRoughnessTexture&&a.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}}class w{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&a.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class R{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&a.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=new l.Ilk(o[0],o[1],o[2]),Promise.all(a)}}class x{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class T{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&a.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=new l.Ilk(o[0],o[1],o[2]),void 0!==r.specularColorTexture&&a.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,l.knz)),Promise.all(a)}}class b{constructor(e){this.parser=e,this.name=h.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,r)}}class _{constructor(e){this.parser=e,this.name=h.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],o=n.images[r.source];let i=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(i=e)}return this.detectSupport().then((function(a){if(a)return s.loadTextureImage(e,r.source,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class M{constructor(e){this.name=h.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,a.ready]).then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,i=new ArrayBuffer(r*o),l=new Uint8Array(t[0],s,n);return a.decodeGltfBuffer(new Uint8Array(i),r,o,l,e.mode,e.filter),i}))}return null}}const S="glTF";class I{constructor(e){this.name=h.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:l.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==S)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,1313821514===s){const s=new Uint8Array(e,12+a,t);this.content=l.Zp0.decodeText(s)}else if(5130562===s){const s=12+a;this.body=e.slice(s,s+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class A{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=h.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},i={},l={};for(const e in r){const t=j[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const n=j[t]||t.toLowerCase();if(void 0!==r[t]){const a=s.accessors[e.attributes[t]],r=F[a.componentType];l[n]=r,i[n]=!0===a.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=i[t];void 0!==n&&(s.normalized=n)}t(e)}),o,l)}))}))}}class L{constructor(){this.name=h.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class P extends l.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new l.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class k{constructor(){this.name=h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return P}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new l.Ilk(1,1,1),e.opacity=1;const a=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&a.push(s.assignTexture(e,"map",n.diffuseTexture,l.knz)),e.emissive=new l.Ilk(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new l.Ilk(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;a.push(s.assignTexture(e,"glossinessMap",t)),a.push(s.assignTexture(e,"specularMap",t,l.knz))}return Promise.all(a)}createMaterial(e){const t=new P(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=l.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class C{constructor(){this.name=h.KHR_MESH_QUANTIZATION}}class N extends l._C8{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let e=0;e!==n;e++)t[e]=s[a+e];return t}}N.prototype.interpolate_=function(e,t,s,n){const a=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=2*o,l=3*o,c=n-t,u=(s-t)/c,d=u*u,m=d*u,h=e*l,p=h-l,f=-2*m+3*d,g=m-d,y=1-f,v=g-d+u;for(let e=0;e!==o;e++){const t=r[p+e+o],s=r[p+e+i]*c,n=r[h+e+o],l=r[h+e]*c;a[e]=y*t+v*s+f*n+g*l}return a};const O=new l._fP;class D extends N{interpolate_(e,t,s,n){const a=super.interpolate_(e,t,s,n);return O.fromArray(a).normalize().toArray(a),a}}const F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H={9728:l.TyD,9729:l.wem,9984:l.YLQ,9985:l.qyh,9986:l.aH4,9987:l.D1R},B={33071:l.uWy,33648:l.OoA,10497:l.rpg},U={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:void 0,LINEAR:l.NMF,STEP:l.Syv};function q(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function V(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function X(e){const t=e.extensions&&e.extensions[h.KHR_DRACO_MESH_COMPRESSION];let s;return s=t?"draco:"+t.bufferView+":"+t.indices+":"+W(t.attributes):e.indices+":"+W(e.attributes)+":"+e.mode,s}function W(e){let t="";const s=Object.keys(e).sort();for(let n=0,a=s.length;n<a;n++)t+=s[n]+":"+e[s[n]]+";";return t}function J(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Y{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new m,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,a=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||s||n&&a<98?this.textureLoader=new l.dpR(this.options.manager):this.textureLoader=new l.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};q(a,r,n),V(r,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(s[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),a=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,n]of e.children.entries())a(n,t.children[s])};return a(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&s.push(a)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){s.load(l.Zp0.resolveURL(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=U[n.type],o=F[n.componentType],i=o.BYTES_PER_ELEMENT,c=i*r,u=n.byteOffset||0,d=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,m=!0===n.normalized;let h,p;if(d&&d!==c){const e=Math.floor(u/d),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(s);c||(h=new o(a,e*d,n.count*d/i),c=new l.vpT(h,d/i),t.cache.add(s,c)),p=new l.kB5(c,r,u%d/i,m)}else h=null===a?new o(n.count*r):new o(a,u,n.count*r),p=new l.TlE(h,r,m);if(void 0!==n.sparse){const t=U.SCALAR,s=F[n.sparse.indices.componentType],i=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,u=new s(e[1],i,n.sparse.count*t),d=new o(e[2],c,n.sparse.count*r);null!==a&&(p=new l.TlE(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(p.setX(t,d[e*r]),r>=2&&p.setY(t,d[e*r+1]),r>=3&&p.setZ(t,d[e*r+2]),r>=4&&p.setW(t,d[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,a=t.images[n];let r=this.textureLoader;if(a.uri){const e=s.manager.getHandler(a.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,s){const n=this,a=this.json,r=a.textures[e],o=a.images[t],i=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[i])return this.textureCache[i];const c=this.loadImageSource(t,s).then((function(t){t.flipY=!1,r.name&&(t.name=r.name);const s=(a.samplers||{})[r.sampler]||{};return t.magFilter=H[s.magFilter]||l.wem,t.minFilter=H[s.minFilter]||l.D1R,t.wrapS=B[s.wrapS]||l.rpg,t.wrapT=B[s.wrapT]||l.rpg,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[i]=c,c}loadImageSource(e,t){const s=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const a=s.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",i=!1;if(void 0!==a.bufferView)o=this.getDependency("bufferView",a.bufferView).then((function(e){i=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then((function(e){return new Promise((function(s,a){let r=s;!0===t.isImageBitmapLoader&&(r=function(e){const t=new l.xEZ(e);t.needsUpdate=!0,s(t)}),t.load(l.Zp0.resolveURL(e,n.path),r,void 0,a)}))})).then((function(e){var t;return!0===i&&r.revokeObjectURL(o),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,s,n){const a=this;return this.getDependency("texture",s.index).then((function(r){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),a.extensions[h.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[h.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(r);r=a.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),a.associations.set(r,t)}}return void 0!==n&&(r.encoding=n),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new l.UY4,l.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new l.nls,l.F5T.prototype.copy.call(t,s),t.color.copy(s.color),this.cache.add(e,t)),s=t}if(n||a||r){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return l.Wid}loadMaterial(e){const t=this,s=this.json,n=this.extensions,a=s.materials[e];let r;const o={},i=a.extensions||{},c=[];if(i[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=e.getMaterialType(),c.push(e.extendParams(o,a,t))}else if(i[h.KHR_MATERIALS_UNLIT]){const e=n[h.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),c.push(e.extendParams(o,a,t))}else{const s=a.pbrMetallicRoughness||{};if(o.color=new l.Ilk(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;o.color.fromArray(e),o.opacity=e[3]}void 0!==s.baseColorTexture&&c.push(t.assignTexture(o,"map",s.baseColorTexture,l.knz)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(c.push(t.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=l.ehD);const u=a.alphaMode||"OPAQUE";if("BLEND"===u?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===u&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==l.vBJ&&(c.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new l.FM8(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;o.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&r!==l.vBJ&&(c.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==l.vBJ&&(o.emissive=(new l.Ilk).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==l.vBJ&&c.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,l.knz)),Promise.all(c).then((function(){let s;return s=r===P?n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),a.name&&(s.name=a.name),V(s,a),t.associations.set(s,{materials:e}),a.extensions&&q(n,s,a),s}))}createUniqueName(e){const t=l.iUV.sanitizeNodeName(e||"");let s=t;for(let e=1;this.nodeNamesUsed[s];++e)s=t+"_"+e;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function a(e){return s[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return $(s,e,t)}))}const r=[];for(let s=0,o=e.length;s<o;s++){const o=e[s],i=X(o),c=n[i];if(c)r.push(c.promise);else{let e;e=o.extensions&&o.extensions[h.KHR_DRACO_MESH_COMPRESSION]?a(o):$(new l.u9r,o,t),n[i]={primitive:o,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,a=s.meshes[e],r=a.primitives,o=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new l.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.Wl3})),i.DefaultMaterial):this.getDependency("material",r[e].material);o.push(t)}var i;return o.push(t.loadGeometries(r)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),i=s[s.length-1],c=[];for(let s=0,u=i.length;s<u;s++){const u=i[s],d=r[s];let m;const h=o[s];if(4===d.mode||5===d.mode||6===d.mode||void 0===d.mode)m=!0===a.isSkinnedMesh?new l.TUv(u,h):new l.Kj0(u,h),!0!==m.isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),5===d.mode?m.geometry=Q(m.geometry,l.UlW):6===d.mode&&(m.geometry=Q(m.geometry,l.z$h));else if(1===d.mode)m=new l.ejS(u,h);else if(3===d.mode)m=new l.x12(u,h);else if(2===d.mode)m=new l.blk(u,h);else{if(0!==d.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);m=new l.woe(u,h)}Object.keys(m.geometry.morphAttributes).length>0&&z(m,a),m.name=t.createUniqueName(a.name||"mesh_"+e),V(m,a),d.extensions&&q(n,m,d),t.assignFinalMaterial(m),c.push(m)}for(let s=0,n=c.length;s<n;s++)t.associations.set(c[s],{meshes:e,primitives:s});if(1===c.length)return c[0];const u=new l.ZAu;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?t=new l.cPb(l.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new l.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),V(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))}loadAnimation(e){const t=this.json.animations[e],s=[],n=[],a=[],r=[],o=[];for(let e=0,i=t.channels.length;e<i;e++){const i=t.channels[e],l=t.samplers[i.sampler],c=i.target,u=void 0!==c.node?c.node:c.id,d=void 0!==t.parameters?t.parameters[l.input]:l.input,m=void 0!==t.parameters?t.parameters[l.output]:l.output;s.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",m)),r.push(l),o.push(c)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(a),Promise.all(r),Promise.all(o)]).then((function(s){const n=s[0],a=s[1],r=s[2],o=s[3],i=s[4],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=a[e],u=r[e],d=o[e],m=i[e];if(void 0===t)continue;let h;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,G[m.path]){case G.weights:h=l.dUE;break;case G.rotation:h=l.iLg;break;default:h=l.yC1}const p=t.name?t.name:t.uuid,f=void 0!==d.interpolation?K[d.interpolation]:l.NMF,g=[];G[m.path]===G.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(p);let y=u.array;if(u.normalized){const e=J(y.constructor),t=new Float32Array(y.length);for(let s=0,n=y.length;s<n;s++)t[s]=y[s]*e;y=t}for(let e=0,t=g.length;e<t;e++){const t=new h(g[e]+"."+G[m.path],s.array,y,f);"CUBICSPLINE"===d.interpolation&&(t.createInterpolant=function(e){return new(this instanceof l.iLg?D:N)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=t.name?t.name:"animation_"+e;return new l.m7l(u,void 0,c)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,s=this.extensions,n=this,a=t.nodes[e],r=a.name?n.createUniqueName(a.name):"";return function(){const t=[],s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&t.push(s),void 0!==a.camera&&t.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===a.isBone?new l.N$j:t.length>1?new l.ZAu:1===t.length?t[0]:new l.Tme,o!==t[0])for(let e=0,s=t.length;e<s;e++)o.add(t[e]);if(a.name&&(o.userData.name=a.name,o.name=r),V(o,a),a.extensions&&q(s,o,a),void 0!==a.matrix){const e=new l.yGw;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],a=this,r=new l.ZAu;n.name&&(r.name=a.createUniqueName(n.name)),V(r,n),n.extensions&&q(s,r,n);const o=n.nodes||[],i=[];for(let e=0,s=o.length;e<s;e++)i.push(Z(o[e],r,t,a));return Promise.all(i).then((function(){return a.associations=(e=>{const t=new Map;for(const[e,s]of a.associations)(e instanceof l.F5T||e instanceof l.xEZ)&&t.set(e,s);return e.traverse((e=>{const s=a.associations.get(e);null!=s&&t.set(e,s)})),t})(r),r}))}}function Z(e,t,s,n){const a=s.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===a.skin)return e;let t;return n.getDependency("skin",a.skin).then((function(e){t=e;const s=[];for(let e=0,a=t.joints.length;e<a;e++)s.push(n.getDependency("node",t.joints[e]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(!e.isMesh)return;const n=[],a=[];for(let e=0,r=s.length;e<r;e++){const r=s[e];if(r){n.push(r);const s=new l.yGw;void 0!==t.inverseBindMatrices&&s.fromArray(t.inverseBindMatrices.array,16*e),a.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new l.OdW(n,a),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(a.children){const t=a.children;for(let a=0,o=t.length;a<o;a++){const o=t[a];r.push(Z(o,e,s,n))}}return Promise.all(r)}))}function $(e,t,s){const n=t.attributes,a=[];function r(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const s=j[t]||t.toLowerCase();s in e.attributes||a.push(r(n[t],s))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(n)}return V(e,t),function(e,t,s){const n=t.attributes,a=new l.ZzF;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new l.Pa4(t[0],t[1],t[2]),new l.Pa4(r[0],r[1],r[2])),e.normalized){const t=J(F[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new l.Pa4,t=new l.Pa4;for(let n=0,a=r.length;n<a;n++){const a=r[n];if(void 0!==a.POSITION){const n=s.json.accessors[a.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const e=J(F[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const o=new l.aLr;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,a=!1,r=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(a=!0),void 0!==s.COLOR_0&&(r=!0),n&&a&&r)break}if(!n&&!a&&!r)return Promise.resolve(e);const o=[],i=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(n){const t=void 0!==u.POSITION?s.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(a){const t=void 0!==u.NORMAL?s.getDependency("accessor",u.NORMAL):e.attributes.normal;i.push(t)}if(r){const t=void 0!==u.COLOR_0?s.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(l)]).then((function(t){const s=t[0],o=t[1],i=t[2];return n&&(e.morphAttributes.position=s),a&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function Q(e,t){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,a=[];if(t===l.z$h)for(let e=1;e<=n;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r}let ee,te,se,ne,ae,re,oe=l.Tme,ie=l.Tme,le=l.Tme,ce=l.Tme,ue=!1,de=[0,0],me=!1,he=[],pe=[];const fe=[];let ge=[],ye=!1,ve=null,Ee=!1,we=!0,Re={},xe=!0,Te={};const be={},_e={screwattack:{obtained:!1,collected:Yt,draw:e=>{De(e)},collide:e=>{Ce(e)}},morphball:{obtained:!1,collected:Jt,draw:e=>{De(e)},collide:e=>{Ce(e)}},yellowswitch:{collected:function(){fe.push(new c.bgRect(Math.floor(Math.random()*mt),Math.floor(Math.random()*ht),Math.floor(10*Math.random())+30,Math.floor(4*Math.random())+10,"rgba(220,221,11,0.95)")),console.log(fe)},draw:e=>{De(e)},collide:e=>{Pe(e)}},redswitch:{collected:function(){for(let e=c.specialObjects.length-1;e>=0;e--)"fire"===c.specialObjects[e].id&&c.specialObjects.splice(e,1)},draw:e=>{De(e)}},greyswitch:{collected:()=>{me=!0,console.log("Hello User. Computer is ready to use in default mode.")},draw:e=>{De(e)},collide:e=>{Ce(e)}},door:{draw:e=>{De(e)},collide:e=>{!async function(){Bt=!0,ut[87]&&!jt&&It&&(console.log("in 65"),function(){let e=Params.prototype.fromJSON({oldParams:!0,wave_type:0,p_env_attack:-3653593375929631e-20,p_env_sustain:.5159887075424194,p_env_punch:.43771442770957947,p_env_decay:-.5177679657936096,p_base_freq:.4211834669113159,p_freq_limit:0,p_freq_ramp:.09771327674388885,p_freq_dramp:.18222975730895996,p_vib_strength:.29777976870536804,p_vib_speed:.8540940284729004,p_arp_mod:.3622890114784241,p_arp_speed:-.032950595021247864,p_duty:-.44415274262428284,p_duty_ramp:-.6385311484336853,p_repeat_speed:.07904504984617233,p_pha_offset:.050250060856342316,p_pha_ramp:.3983093798160553,p_lpf_freq:.5602583885192871,p_lpf_ramp:-.0018845867598429322,p_lpf_resonance:-.17684580385684967,p_hpf_freq:2.0634999486901506e-8,p_hpf_ramp:.11631236225366592,sound_vol:.25,sample_rate:44100,sample_size:8});e.mutate(),sfxr.toAudio(e).play(),ye=!ye,!0===ye?(ge=fe,we=!1,$e=1,Qe=2):(ge=c.rects,we=!0,$e=3,Qe=6)}(),jt=!0,rt=!1,await new Promise((e=>setTimeout(e,1e3))),setTimeout((()=>{rt=!0,jt=!1}),1e3)),Ie=!0}()}},fire:{collected:Jt,draw:e=>{Me(e)},collide:e=>{Le(e)}},hflip:{collected:Wt,draw:e=>{De(e)},collide:e=>{Ce(e)}},mouse:{collected:$t,draw:e=>{De(e)},collide:e=>{Ce(e)}},eyes:{collected:Zt,draw:e=>{De(e)},collide:e=>{Ce(e)}},checkpoint:{draw:e=>{Oe(e)},collide:e=>{ke(e)}},"3DPerson":{draw:e=>{Ne(e)}},"3DComp":{draw:e=>{Ne(e)}},"3DArrow":{draw:e=>{Ne(e)},collected:e=>Wt(e),collide:e=>{Wt(e)}},"3DTree":{},"3DHouse":{}},Me=e=>{Ht(Fe,e)&&((e,t,s,a,r,o=0)=>{r.save();let i=Math.floor(o),l=1;r.fillStyle=n[2][i],r.fillRect(e,t,s,a);for(let o=6;o>=3;o-=1){i+=l,i>14?l=-1:i<1&&(l=1),r.fillStyle=n[2][Math.floor(i)];const c=1-2/o;r.fillRect(e+s/o,t+a/o,s*c,a*c)}r.restore()})(e.x+pt,e.y+ft,e.width,e.height,te,Je)};let Se,Ie,Ae=Se=Ie=!1;const Le=()=>{if(Ae=!0,!0===st&&!1===Se){Se=!0;let e=Params.prototype.fromJSON({oldParams:!0,wave_type:0,p_env_attack:-3653593375929631e-20,p_env_sustain:.5159887075424194,p_env_punch:.43771442770957947,p_env_decay:-.5177679657936096,p_base_freq:.4211834669113159,p_freq_limit:0,p_freq_ramp:.09771327674388885,p_freq_dramp:.18222975730895996,p_vib_strength:.29777976870536804,p_vib_speed:.8540940284729004,p_arp_mod:.3622890114784241,p_arp_speed:-.032950595021247864,p_duty:-.44415274262428284,p_duty_ramp:-.6385311484336853,p_repeat_speed:.07904504984617233,p_pha_offset:.050250060856342316,p_pha_ramp:.3983093798160553,p_lpf_freq:.5602583885192871,p_lpf_ramp:-.0018845867598429322,p_lpf_resonance:-.17684580385684967,p_hpf_freq:2.0634999486901506e-8,p_hpf_ramp:.11631236225366592,sound_vol:.25,sample_rate:44100,sample_size:8});return e.mutate(),void sfxr.toAudio(e).play()}if(!0===Se||!0===st)return;rt=!1,ze.play();const e=Fe.color;Fe.color="red",setTimeout((t=>{rt=!0,Qt(),Fe.color=e}),500)},Pe=e=>{0===Fe.g&&!1===Fe.flip&&(c.specialObjects.splice(c.specialObjects.indexOf(e),1),_e.yellowswitch.collected())},ke=e=>{if(!e.active){e.color="yellow",Te.active=!1,Te.color="",Fe.spawn=[e.x+e.width/2,e.y-8],Te=e;const t=sfxr.generate("explosion");sfxr.play(t)}e.active=!0,!1===Ee&&ts(!0)},Ce=e=>{_e[e.name].collected(),c.specialObjects.splice(c.specialObjects.indexOf(e),1)},Ne=e=>{i(e.x+pt,e.y+ft,25,25,te,"orange",!0),Ht(Fe,e)&&(shouldDraw3DObjs=!0,ue||(ne.add(_e[e.name].file),ue=_e[e.name].file,de=[e.x-320,240-e.y]))},Oe=e=>{let t="gray";e.color&&(t=e.color);let s=1;switch(e.values.dir){case 0:default:i(e.x+pt,e.y+25+ft,e.width,e.height-25,te,t,!1,!0);break;case 1:i(e.x+pt+25,e.y+ft,e.width,e.height-25,te,t,!1,!0);break;case 2:i(e.x+pt,e.y-25+ft,e.width,e.height-25,te,t,!1,!0),s=-1;break;case 3:i(e.x+pt-25,e.y+ft,e.width,e.height-25,te,t,!1,!0)}if(e.active){const t=e.y+ft+25*s+(e.height-25)/2;te.beginPath(),te.setLineDash([3]),te.moveTo(e.x+pt,t),te.lineTo(e.x+pt+e.width,t),te.strokeStyle="black",te.closePath(),te.stroke(),te.setLineDash([])}},De=e=>{te.drawImage(be[e.name],e.x+pt,e.y-e.originY+ft)},Fe={x:1038,y:0,halfWidth:4,halfHeight:7,newX:825,newY:0,scale:1,name:"",flip:!1,g:0,spawn:[1038,200]};let He,Be,Ue,je,Ge,Ke,qe,Ve,ze,Xe=0,We=0,Je=0,Ye=0,Ze=0,$e=3,Qe=6,et=!0,tt=!1,st=!1,nt=!1,at=!1,rt=!0,ot=!1,it=!1,lt=!1,ct=5e3,ut=[],dt=0;const mt=640,ht=480;let pt=-738,ft=100;const gt=(e,t=!1)=>{e&&e.username&&e.items&&e.color&&e.shape>=0?(Fe.name=e.username,Xe=e.color,Fe.shape=e.shape,what_is_my_name="uh... "+e.username):console.error("Did not receive player data."),Re.name=Fe.name,Re.color=Xe,Re.movement=[],goToThePlace=es,ge=c.rects;let s,n,a=!0;s=Math.floor(Math.random()*c.rects.length),n=c.rects[s].values.color,pe.push(n);for(let e=0;e<10;e++){for(a=!0;a;)s=Math.floor(Math.random()*c.rects.length),n=c.rects[s].values.color,n!==pe[e]&&(a=!1);pe.push(n)}console.log(pe),e.items&&Gt(e.items),je=new Audio("assets/sound/buttonClick.wav"),Ge=new Audio("assets/sound/itemGet.wav"),Ge=new Audio("assets/sound/itemGet.wav"),ze=new Audio("assets/sound/explosion.wav"),Ke=new Audio("assets/sound/the-earth.mp3"),Ke.volume=.25,qe=new Audio("assets/sound/warp-whistle.mp3"),qe.volume=.3,Ve=new Audio("assets/sound/world-sky.mp3"),Ve.volume=.25,t?document.addEventListener("click",(e=>{Ke.loop=!0}),{once:!0}):Ke.loop=!0;let r=document.querySelector("#canvas_player"),o=document.querySelector("#canvas_walkers"),i=document.querySelector("#canvas_bg"),u=document.querySelector("#canvas_js3");document.getElementById("resetBtn").onmousedown=e=>{e.preventDefault(),Qt()},document.getElementById("screwattack_active").onmousedown=e=>{m(!0)},document.getElementById("screwattack_inactive").onmousedown=e=>{m(!1)};const m=e=>{!0===playerShouldEnterVoid?(document.getElementById("screwattack_active").classList.remove("noDisplay"),document.getElementById("screwattack_active").classList.add("inline"),document.getElementById("screwattack_inactive").classList.remove("inline"),document.getElementById("screwattack_inactive").classList.add("noDisplay")):(document.getElementById("screwattack_inactive").classList.remove("noDisplay"),document.getElementById("screwattack_inactive").classList.add("inline"),document.getElementById("screwattack_active").classList.remove("inline"),document.getElementById("screwattack_active").classList.add("noDisplay"))};ee=o.getContext("2d"),te=r.getContext("2d"),se=i.getContext("2d"),ne=new l.xsS,re=new l.cPb(40,1.3333333333333333,.1,1e3),re.position.set(0,0,10),re.lookAt(0,0,0),ae=new l.CP7({canvas:u,alpha:!0}),ae.setClearColor(0,0);const h=new l.Mig(16777215);ne.add(h);const p=new l.Ox3(16777215,.5);ne.add(p),re.position.z=100;const f=new d;f.load("assets/img/character.glb",(function(e){oe=e.scene,oe.scale.x=oe.scale.y=oe.scale.z=1,e.scene.name="3DPerson",_e["3DPerson"].file=e.scene}),void 0,(function(e){console.error(e)})),f.load("assets/img/arrowright.glb",(function(e){e.scene.scale.set(.25,.25,1),e.scene.position.x+=2,e.scene.position.y-=2,e.scene.name="3DArrow",_e["3DArrow"].file=e.scene}),void 0,(function(e){console.error(e)})),f.load("assets/img/SavePc.glb",(function(e){ie=e.scene,ie.scale.x=ie.scale.y=ie.scale.z=9,ie.rotation.y=Math.PI,e.scene.name="3DComp",_e["3DComp"].file=e.scene,ie.position.y-=30}),void 0,(function(e){console.error(e)})),f.load("assets/img/Tree.gltf",(function(e){le=e.scene,le.scale.x=le.scale.y=le.scale.z=5,le.rotation.y=Math.PI,console.log(le),e.scene.name="3DTree",_e["3DTree"].file=e.scene,le.position.y-=30}),void 0,(function(e){console.error(e)})),f.load("assets/img/House.gltf",(function(e){ce=e.scene,ce.scale.x=ce.scale.y=ce.scale.z=9,ce.rotation.y=Math.PI,e.scene.name="3DHouse",_e["3DHouse"].file=e.scene,ce.position.y-=30}),void 0,(function(e){console.error(e)})),Be=o.width,Ue=o.height,document.addEventListener("keydown",ss),document.addEventListener("keyup",ns),r.addEventListener("contextmenu",(e=>{e.preventDefault()})),r.addEventListener("wheel",(e=>{e.preventDefault()})),c.clouds&&c.clouds.length>0&&c.clouds.forEach((e=>{fe.push(new c.bgRect(630*Math.random()+5,470*Math.random()+5,10*Math.random()+30,4*Math.random()+3,e))}));for(let e=0;e<10;e++)fe.push(new c.bgRect(Math.floor(Math.random()*mt),Math.floor(Math.random()*ht),Math.floor(10*Math.random())+30,Math.floor(4*Math.random())+10,"rgba(0,0,0,0.3)"));Nt(),ee.fillStyle="black",setInterval(_t,1e3/60),setInterval(Nt,1e3/15)},yt=(new l.iMs,new l.FM8),vt=new l.xo$(8,8,16),Et=new l.vBJ({color:16776960}),wt=new l.Kj0(vt,Et);let Rt=!1;const xt=(e=!0)=>{if(e)ae.setViewport(de[0]+pt,de[1]-ft,mt,ht);else{ae.setViewport(0,0,mt,ht),yt.x=4*He.x-1280,yt.y=4*-He.y+960;const e=new l.Pa4(yt.x,yt.y,-1).unproject(re);if(e.z=1,wt.position.set(e.x,e.y,e.z),ne.add(wt),Rt)bt();else{const e=(new l.ZzF).setFromObject(le);(new l.ZzF).setFromObject(wt).intersectsBox(e)&&(Rt=!0)}}me&&(ie.rotation.y>=0?ie.rotation.y-=.01:me=!1),ae.render(ne,re)};let Tt=!1;const bt=()=>{le.scale.x>=15&&!Tt&&(Tt=!0),Tt?Mt(le):(le.scale.x*=1.01,le.scale.y*=1.01,le.position.y-=.1,le.scale.z*=1.01)},_t=()=>{!at&&rt?(At(),te.clearRect(0,0,640,480),Lt(),o(Fe,pt,ft,te,!1,Ye,Ze),lt&&(ct-=17,ct>0?Fe.flip?i(Fe.x-16+pt,Fe.y-12+ft,8,ct/200,te,"orange",!1,!0):i(Fe.x+10+pt,Fe.y-12+ft,8,ct/200,te,"orange",!1,!0):function(){const e=sfxr.generate("jump");e.sound_vol=.05,sfxr.play(e),Fe.g=0,Fe.halfWidth=4,Fe.halfHeight=7,Fe.flip=!1,Fe.scale=Math.abs(Fe.scale),lt=!1}())):at&&(es(),rt&&(St(),te.fillStyle="black",te.clearRect(0,0,640,480),te.save(),te.scale(2,2),te.drawImage(be.uni,-320+pt,-240+ft),te.restore(),xt(!1),zt(!1,!0),((e,t,s,n,o)=>{t.save(),t.translate(e.x,e.y),t.rotate(e.dirRad),t.beginPath(),t.arc(0,-3*e.scale,Math.abs(3*e.scale),r,a);const i=(3-n)*e.scale,l=(2+o)*e.scale;t.moveTo(0,-e.scale),t.lineTo(0,5*e.scale),t.lineTo(-l,8*e.scale),t.moveTo(0,5*e.scale),t.lineTo(l,8*e.scale),t.moveTo(-3*e.scale,i),t.lineTo(0,3*e.scale),t.lineTo(3*e.scale,i),t.moveTo(0,3*e.scale),t.closePath(),e.color&&(t.strokeStyle=e.color),t.lineWidth=2,t.setLineDash([1,5]),t.lineDashOffset=10*Math.random(),t.stroke(),t.restore()})(He,te,0,Ze,Ye)))},Mt=(e=l.Tme)=>{ut[65]&&(e.rotation.y+=.01),ut[68]&&(e.rotation.y-=.01),ut[87]&&(e.rotation.x-=.01),ut[83]&&(e.rotation.x+=.01),ut[32]&&(e.scale.x/=1.01,e.scale.y/=1.01,e.position.y+=.1,e.scale.z/=1.01),ut[16]&&(e.scale.x*=1.01,e.scale.y*=1.01,e.position.y-=.1,e.scale.z*=1.01)},St=()=>{ut[65]&&(He.dirRad+=.01),ut[68]&&(He.dirRad-=.01),He.hSpeed=3*Math.cos(He.dirRad),He.vSpeed=3*Math.sin(He.dirRad),He.x+=He.hSpeed/2,He.y+=He.vSpeed/2,He.x>Be+20?He.x=-20:He.x<-20&&(He.x=Be+20),He.y>Ue+20?He.y=-20:He.y<-20&&(He.y=Ue+20),pt-=He.hSpeed/5,ft-=He.vSpeed/5,(Tt&&pt>-1500&&pt<250||ft>-1500&&ft<250)&&(Tt=!1)};let It=!1;const At=()=>{let e=0,t=0,s=!1;nt&&ut[16]?(ut[65]&&(pt+=3),ut[68]&&(pt-=3),ut[87]&&(ft+=3),ut[83]&&(ft-=3)):0===Fe.g?(ut[65]&&(e=-$e,s=!0),ut[68]&&(e=$e,s=!0),t=Fe.flip?-Qe:Qe):1===Fe.g&&(ut[87]&&(t=-$e,s=!0),ut[83]&&(t=$e,s=!0),e=Fe.flip?Qe:-Qe),nt&&ut[82]&&(pt=300-Fe.x,ft=300-Fe.y),Fe.newX=Fe.x+e,Fe.newY=Fe.y+t;let n=Dt(Fe,e,t);if(n[0]?(ye||(pt+=Fe.x-Fe.newX,ft+=Fe.y-Fe.newY),Fe.x=Fe.newX,Fe.y=Fe.newY):(Fe.x+=e,Fe.y+=t,ye||(pt-=e,ft-=t)),ye&&(Fe.x+pt>Be+20?Fe.x-=Be+20:Fe.x+pt<-20&&(Fe.x+=Be+20),Fe.y+ft>Ue+20?Fe.y-=Ue+20:Fe.y+ft<-20&&(Fe.y+=Ue+20),!1===It&&!0===n[1])){const e=sfxr.generate("click");e.sound_vol=.1,sfxr.play(e)}!0===n[1]&&!1===Ee&&ts(!0),It=n[1],zt(s,n[1]),Ut(Fe)},Lt=()=>{c.rects.forEach((e=>{i(e.x+pt,e.y+ft,e.width,e.height,te,e.values.color,we,!1)}));let e=!1;c.specialObjects.forEach((t=>{"3D"===t.name.substring(0,2)?(i(t.x+pt,t.y+ft,t.width,t.height,te,"orange",!1),Ht(Fe,t)&&(e=!0,ue!==t.name&&(ne.remove(ue),ue=!1),!ue&&_e[t.name].file&&(t.values&&(0===t.values.dir?_e[t.name].file.rotation.y=0:1===t.values.dir&&(_e[t.name].file.rotation.y=-Math.PI)),ne.add(_e[t.name].file),ue=_e[t.name].file,de=[t.x-320,240-t.y]))):_e[t.name].draw(t)})),e?xt():!1!==ue&&(ne.remove(ue),ue=!1),null!==ve&&(ve.x+=ve.hSpeed,te.save(),i(ve.x+pt,ve.y+ft,ve.width,ve.height,te,ve.values.color,!1,!0),ve.x+pt>Be+20&&(ve.x-=Be+80)),Ot&&(te.globalAlpha=0,te.drawImage(be.theImage,0,0),kt=setInterval((()=>{te.clearRect(0,0,mt,ht),te.globalAlpha=Math.sin(Pt),te.drawImage(be.theImage,0,0),Pt+=.5}),100),rt=!1,setTimeout((()=>{rt=!0,clearInterval(kt)}),6e3))};let Pt=0,kt=0,Ct=.4;const Nt=()=>{se.clearRect(0,0,mt,ht),Je+=Ct,Je>14.5?Ct=-2:Je<.5&&(Ct=2),i(0,0,Be,Ue,se,"white",!0),dt+=0,fe.forEach((function(e){e.x+=e.hSpeed,e.y+=e.vSpeed,xe&&(e.x>Be+20?e.x=-20:e.x<-20&&(e.x=Be+20),e.y>Ue+20?e.y=-20:e.y<-20&&(e.y=Ue+20)),i(e.x,e.y,e.width,e.height,se,e.values.color,!0)}))};let Ot=!1;const Dt=(e,t,s)=>{let n=e,a=[!1,!1];return Ot=!1,!0===ye&&(n={...e},n.x+=pt,n.y+=ft,n.newX+=pt,n.newY+=ft),ge.forEach((r=>{Ft(n,r)&&(a[0]=!0,r.values&&r.values.color&&r.values.color!==he[he.length-1]&&(he.push(r.values.color),console.log(r.values.color+"new color")),r.values&&"rgba(220,221,11,0.95)"===r.values.color&&(Ot=!0),((e,t)=>e.y+(e.halfHeight-1)<t.y&&e.newY+(e.halfHeight+1)>=t.y)(n,r)||((e,t)=>e.y-(e.halfHeight-2)>=t.y+t.height&&e.newY-(e.halfHeight+2)<t.y+t.height)(n,r)?(e.newY-=s,0===n.g&&(tt||(et=!0),r.isPlayerRect||(a[1]=!0))):(((e,t)=>e.x-(e.halfWidth-2)>=t.x+t.width&&e.newX-(e.halfWidth+2)<t.x+t.width)(n,r)||((e,t)=>e.x+(e.halfWidth-2)<=t.x&&e.newX+(e.halfWidth+2)>=t.x)(n,r))&&(e.newX-=t,1===n.g&&(tt||(et=!0),r.isPlayerRect||(a[1]=!0))))})),a},Ft=(e,t)=>e.newX-e.halfWidth<t.x+t.width&&e.newX+e.halfWidth>t.x&&e.newY-e.halfHeight<t.y+t.height&&e.newY+e.halfHeight>t.y,Ht=(e,t)=>e.newX-e.halfWidth<t.x+t.width+400&&e.newX+e.halfWidth>t.x-400&&e.newY-e.halfHeight<t.y+t.height+500&&e.newY+e.halfHeight>t.y-500;let Bt=!1;const Ut=e=>{Ae=!1,Bt=!1,c.specialObjects.forEach((t=>{Ft(e,t)&&("3D"===t.name.substring(0,2)&&"3DArrow"!==t.name||_e[t.name].collide(t))}))};let jt=!1;const Gt=e=>{be.screwattack=document.getElementById("screwattack_inactive"),be.morphball=document.getElementById("morphball"),be.greyswitch=document.getElementById("greyswitch"),be.yellowswitch=document.getElementById("yellowswitch"),be.redswitch=document.getElementById("redswitch"),be.door=document.getElementById("door"),be.hflip=document.getElementById("hflip"),be.uni=document.getElementById("uni"),be.mouse=document.getElementById("mouse"),be.eyes=document.getElementById("eyes"),be.theImage=document.getElementById("theImage"),!0===e.morphball&&Jt(!1),!0===e.screwattack&&Yt(!1),!0===e.mouse&&$t(!1),!0===e.eyes&&Zt(!1)},Kt=(e=0)=>{Fe.shape=e,Fe.scale=1===e?2:2===e?.5:1};let qt=!0,Vt=!0;const zt=(e=!1,t=!1)=>{e&&t?qt?(Ye+=.25,Ye>=2&&(qt=!1)):(Ye-=.25,Ye<=-2&&(qt=!0)):0!==Ye&&(Ye=0),t?0!==Ze&&(Ze=0):Vt?(Ze+=.4,Ze>=2&&(Vt=!1)):(Ze-=.4,Ze<=-2&&(Vt=!0))};let Xt=!0;function Wt(e){if(e.values&&1===e.values.dir?(Fe.g=1,Fe.flip=!1,Fe.scale=Math.abs(Fe.scale)):(Fe.g=1,Fe.flip=!0,Fe.scale=-1*Math.abs(Fe.scale)),Fe.halfHeight=4,Fe.halfWidth=7,lt=!0,ct=5e3,Xt){const e=sfxr.generate("powerUp");sfxr.play(e),Xt=!1,setTimeout((()=>{Xt=!0}),100)}}function Jt(e=!0){document.getElementById("morphball").classList.remove("noDisplay"),document.getElementById("morphball").classList.add("inline"),ot=!0,it=!0,!0===e&&(u(Fe.name,"morphball"),Ge.play())}function Yt(e=!0){document.getElementById("screwattack_active").classList.remove("noDisplay"),document.getElementById("screwattack_active").classList.add("inline"),playerShouldEnterVoid=!0,tt=!0,!0===e&&(u(Fe.name,"screwattack"),Ge.play())}function Zt(e=!0){document.getElementById("eyes").classList.remove("noDisplay"),document.getElementById("eyes").classList.add("inline"),nt=!0,!0===e&&(u(Fe.name,"eyes"),Ge.play())}function $t(e=!0){document.getElementById("mouse").classList.remove("noDisplay"),document.getElementById("mouse").classList.add("inline"),st=!0,Ee=!0,document.body.addEventListener("mousedown",(e=>{if(!Ee)return;const t=(e=>{let t,s,n;return"canvas"!=e.target.localName?(console.log("not on canvas (utilities 160)"),null):(n=Math.floor(2*Math.random()),t=e.layerX-25,s=e.layerY-10,[t,s])})(e);if(null!==t){ts(!1);const e=sfxr.generate("click");e.sound_vol=.1,sfxr.play(e),null==ve?(ve=new c.bgRect(t[0]-pt,t[1]-ft,50,20,Xe),ve.values={color:Xe},ve.hSpeed=2,ve.isPlayerRect=!0,ge.push(ve)):(ve.x=t[0]-pt,ve.y=t[1]-ft)}})),!0===e&&(u(Fe.name,"mouse"),Ge.play())}const Qt=()=>{document.getElementById("theGood").hidden=!1,Fe.x=Fe.spawn[0],Fe.y=Fe.spawn[1],Fe.flip=!1,Fe.scale=Math.abs(Fe.scale),Fe.newX=300,Fe.newY=300,pt=300-Fe.x,ft=300-Fe.y,(async e=>{let t=await fetch("/..."+e+"...",{method:"GET",headers:{Accept:"image/*"}}),s=await t.json();switch(t.status){case 200:case 204:break;default:console.error(s)}})(Fe.name)};function es(){at||(rt=!1,He=new c.bgRect(Fe.x,-20,10*Math.random()+30,4*Math.random()+3,Xe),He.dirRad=-Math.PI/2,He.halfWidth=He.width/2,He.halfHeight=He.height/2,He.scale=3,ne.add(_e["3DTree"].file),Ke.pause(),qe.play(),document.getElementById("resetBtn").disabled=!0,setTimeout((()=>{Ve.play(),rt=!0,xe=!1,Ve.addEventListener("timeupdate",(e=>{Ve.currentTime>Ve.duration-.12&&(Ve.currentTime=0,Ve.play())}))}),4e3),at=!0),We<254&&(We+=.2,Fe.y+=.85),Fe.color=`#000000${(255-We).toString(16).substring(0,2)}`,o(Fe,pt,ft,te,!0,0),fe.forEach((e=>{e.color=`rgba(${We}, ${We}, ${We}, 0.1)`})),He.color=`${Xe}${We.toString(16).substring(0,2)}`,c.rects.forEach((e=>{e.color=`rgba(${We}, ${We}, ${We}, 0.5)`}))}const ts=e=>{!0===st&&(!0===e?(document.getElementById("mouse").classList.remove("noDisplay"),document.getElementById("mouse").classList.add("inline"),document.getElementById("mouse_inv").classList.remove("inline"),document.getElementById("mouse_inv").classList.add("noDisplay"),Ee=!0):(document.getElementById("mouse_inv").classList.remove("noDisplay"),document.getElementById("mouse_inv").classList.add("inline"),document.getElementById("mouse").classList.remove("inline"),document.getElementById("mouse").classList.add("noDisplay"),Ee=!1))},ss=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:ut[e.keyCode]=!0;break;case 32:if(e.preventDefault(),!ut[e.keyCode]&&(et||tt)){Fe.flip=!Fe.flip,Fe.scale*=-1,et=!1;const e=sfxr.generate("jump");e.sound_vol=.1,sfxr.play(e)}ut[e.keyCode]=!0}},ns=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:case 32:ut[e.keyCode]=!1}}}},e=>{e(e.s=316)}]);