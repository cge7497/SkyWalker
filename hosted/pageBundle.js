(self.webpackChunksky_walker=self.webpackChunksky_walker||[]).push([[768],{264:(e,t,s)=>{const n=s(795),a=e=>{const[t,s]=React.useState(e.players),[n,a]=React.useState(e.displayMode);React.useEffect((async()=>{if(1===n){const e=await fetch("/getPlayers"),t=await e.json();s(t)}}),[n]);const r=()=>{a(0==n?1:0)};if(!n||0===n)return React.createElement("button",{id:"playerDisplayBtn",onClick:e=>{r()}}," O -|- /\\");if(!t||0===t.length)return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{id:"closeWidgetBtn",onClick:r},"X"),React.createElement("h2",null,"No Players Yet..."));const o=t.map((e=>React.createElement("tr",{key:e.username},React.createElement("td",null,e.username),React.createElement("td",{className:"colorText",style:{backgroundColor:e.color}}))));return React.createElement("div",{id:"playerDisplayList"},React.createElement("button",{id:"closeWidgetBtn",onClick:r},"X"),React.createElement("table",null,React.createElement("caption",null,React.createElement("h3",null,React.createElement("u",null,"Current Players"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Username"),React.createElement("th",null,"Color"))),React.createElement("tbody",null,o)))},r=e=>React.createElement("div",{className:"center"},React.createElement("h3",{className:"inline"},"Items"),React.createElement("img",{id:"screwattack",src:"assets/img/screwattack.png",className:"noDisplay",width:"16",height:"16",alt:"Infinite Flip Powerup",title:"Space"}),React.createElement("img",{id:"morphball",src:"assets/img/morphball.png",className:"noDisplay",width:"16",height:"16",alt:"Shrinking Powerup",title:"W"}),React.createElement("img",{id:"mouse",src:"assets/img/mouse.png",className:"noDisplay",width:"16",height:"16",alt:"Mouse Platform",title:"Click on game screen"}),React.createElement("img",{id:"eyes",src:"assets/img/eyes.png",className:"noDisplay",width:"16",height:"32",alt:"Camera Shift Powerup",title:"Hold Shift. R to reset."}),React.createElement("img",{id:"yellowswitch",src:"assets/img/yellowswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Yellow Switch"}),React.createElement("img",{id:"redswitch",src:"assets/img/redswitch.png",className:"noDisplay",width:"32",height:"32",alt:"Red Switch"}),React.createElement("img",{id:"greyswitch",src:"assets/img/greyswitch.png",className:"noDisplay",width:"25",height:"25",alt:"Grey Switch"}),React.createElement("img",{id:"hflip",src:"assets/img/hflip.png",className:"noDisplay",width:"25",height:"25",alt:"Arrow Right"}),React.createElement("img",{id:"uni",src:"assets/img/uni.jpg",className:"noDisplay"}),React.createElement("div",{className:"center",id:"instructions"},React.createElement("div",{id:"moveInstructions",className:"inline"},"Use '",React.createElement("strong",null,"A"),"' and '",React.createElement("strong",null,"D"),"' to move, "),React.createElement("div",{id:"spaceInstructions",className:"inline"}," ",React.createElement("strong",null," SPACE")," to flip.")),React.createElement("button",{id:"resetBtn",disabled:!0},"Back to Save")),o=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Payment Example: "),React.createElement("input",{id:"oldPass",type:"text",name:"oldPass",placeholder:"Payment Info"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"Payment Example: "),React.createElement("input",{id:"newPass",type:"text",name:"newPass",placeholder:"Payment Info"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("input",{className:"formSubmit",id:"changePasswordSubmit",type:"submit",disabled:!0,value:"Purchase (Demo)"}))},i=async e=>{const t={shape:e,_csrf:document.getElementById("_csrf").value};ReactDOM.render(React.createElement(o,{displayMode:2}),document.getElementById("formContent")),await fetch("/setShape",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n.setShape(e)},l=e=>{const[t,s]=React.useState(e.displayMode),[n,a]=React.useState(e.disabled),[r,o]=React.useState(e.selected);React.useEffect((async()=>{a(e.disabled),o(e.selected)}),[e]);const l=()=>{s(0===t?1:0)};if(!t||0===t)return React.createElement("button",{disabled:n,id:"payModelBtn",onClick:l},"∇ ▢ ◇");const c=()=>React.createElement("table",{id:"payModelTable"},React.createElement("caption",null,React.createElement("h3",null,React.createElement("u",null,"Shape Shop"))),React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Shape"),React.createElement("th",null,"Price"))),React.createElement("tbody",null,React.createElement("tr",{className:0==r?"selected":"",onClick:e=>{o(0),i(0)}},React.createElement("td",null,"Circle"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:1==r?"selected":"",onClick:e=>{o(1),i(1)}},React.createElement("td",null,React.createElement("strong",null,"Big")),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:2==r?"selected":"",onClick:e=>{o(2),i(2)}},React.createElement("td",null,"Tiny"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:3==r?"selected":"",onClick:e=>{o(3),i(3)}},React.createElement("td",null,"Spider"),React.createElement("td",null,React.createElement("em",null,"$ Free "))),React.createElement("tr",{className:4==r?"selected":"",onClick:e=>{o(4),i(4)}},React.createElement("td",null,React.createElement("em",null,"Handsome")),React.createElement("td",null,React.createElement("em",null,"$ Free ")))));return React.createElement("div",{id:"payModelDisplay"},React.createElement("button",{id:"closeWidgetBtn",onClick:l},"X"),React.createElement(c,null))};e.exports={PlayerDisplay:a,GameInfo:r,PayModelDisplay:l,init:()=>{ReactDOM.render(React.createElement(r,null),document.getElementById("gameInfo")),ReactDOM.render(React.createElement(a,{players:[],displayMode:0}),document.getElementById("playerDisplay")),ReactDOM.render(React.createElement(l,{displayMode:0,disabled:!0,selected:0}),document.getElementById("payModel"))}}},603:e=>{const t=e=>{document.getElementById("createResponse").textContent=e};e.exports={handleError:t,sendPost:async(e,s,n)=>{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();if(document.getElementById("createResponse").textContent="",r.error)return t(r.error);r.message&&(document.getElementById("createResponse").textContent=r.message),r.redirect&&(window.location=r.redirect),n&&n(r)},hideError:()=>{document.getElementById("createResponse").textContent=""}}},689:(e,t,s)=>{"use strict";s.r(t),s.d(t,{bgRect:()=>n,clouds:()=>o,getData:()=>i,rects:()=>a,specialObjects:()=>r});class n{constructor(e,t,s,n,a){this.x=e,this.y=t,this.width=s,this.height=n,this.color=a,this.hSpeed=n*s/150,this.vSpeed=0}}let a=[],r=[],o=[];const i=async()=>{let e=await fetch("/getLevel",{method:"GET",headers:{Accept:"application/json"}});const t=await e.json();t.level&&(a=t.level.layers[0].entities,r=t.level.layers[1].entities),t.level.clouds&&t.level.clouds.length>0&&(o=[...t.level.clouds])}},316:(e,t,s)=>{const n=s(603),a=s(689),{startGameLogic:r}=s(795),o=s(264),i=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=document.querySelector("#_csrf").value;return t&&s?(n.sendPost(e.target.action,{username:t,pass:s,_csrf:a},p),!1):(n.handleError("Username or password is empty!"),!1)},l=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#user").value,s=e.target.querySelector("#pass").value,a=e.target.querySelector("#pass2").value,r=e.target.querySelector("#colorField").value,o=document.querySelector("#_csrf").value;return t&&s&&a?s!==a?(n.handleError("Passwords do not match!"),!1):(n.sendPost(e.target.action,{username:t,pass:s,pass2:a,color:r,_csrf:o},p),!1):(n.handleError("All fields are required!"),!1)},c=e=>{e.preventDefault(),n.hideError();const t=e.target.querySelector("#oldPass").value,s=e.target.querySelector("#newPass").value,a=document.querySelector("#_csrf").value;return t&&s?t===s?(n.handleError("The two passwords are the same!"),!1):(n.sendPost(e.target.action,{oldPass:t,newPass:s,_csrf:a},u),!1):(n.handleError("One or more password fields are empty!"),!1)},u=e=>{e.message&&(document.getElementById("oldPass").value="",document.getElementById("newPass").value="")},d=e=>React.createElement("form",{id:"loginForm",name:"loginForm",onSubmit:i,action:"/login",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username: "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("input",{className:"formSubmit",type:"submit",value:"Log in"})),m=e=>React.createElement("form",{id:"signupForm",name:"signupForm",onSubmit:l,action:"/signup",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"username"},"Username: "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"colorField"},"Color: "),React.createElement("input",{id:"colorField",type:"color",name:"color",defaultValue:"#6495ed"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"pass2"},"Password: "),React.createElement("input",{id:"pass2",type:"password",name:"pass2",placeholder:"password"})),React.createElement("input",{className:"formSubmit",type:"submit",value:"Create Account"})),h=e=>{const[t,s]=React.useState(e.displayMode);return React.useEffect((async()=>{s(e.displayMode)}),[e]),0===t?null:React.createElement("form",{id:"changePasswordForm",name:"changePasswordForm",onSubmit:c,action:"/changePassword",method:"POST",className:"inputForm"},React.createElement("div",{className:"floatLeft"},React.createElement("label",{htmlFor:"oldPass"},"Current Password: "),React.createElement("input",{id:"oldPass",type:"password",name:"oldPass",placeholder:"password"})),React.createElement("div",{className:"floatRight"},React.createElement("label",{htmlFor:"newPass"},"New Password: "),React.createElement("input",{id:"newPass",type:"password",name:"newPass",placeholder:"password"})),React.createElement("button",{type:"button",id:"closeForm",onClick:e=>{s(0)}},"Close Form"),React.createElement("input",{className:"formSubmit",id:"changePasswordSubmit",type:"submit",value:"Set Password"}))},p=(e,t)=>(r(e,t),ReactDOM.render(React.createElement(o.PayModelDisplay,{displayMode:0,disabled:!1,selected:e.shape}),document.getElementById("payModel")),document.getElementById("createResponse").textContent="Logged in as "+e.username,document.getElementById("resetBtn").disabled=!1,document.getElementById("loginButton").classList.add("hidden"),document.getElementById("signupButton").classList.add("hidden"),document.getElementById("changePasswordButton").classList.remove("hidden"),document.getElementById("logoutLink").classList.remove("hidden"),ReactDOM.render(null,document.getElementById("formContent")),!1);window.onload=async()=>{a.getData();const e=await fetch("/init"),t=await e.json();o.init();const s=document.getElementById("loginButton"),n=document.getElementById("signupButton"),r=document.getElementById("changePasswordButton");document.getElementById("_csrf").value=t.csrfToken,r.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(h,{displayMode:1}),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),t.account?(p(t.account,!0),document.getElementById("createResponse").textContent="Logged in as "+t.account.username):(s.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(d,null),document.getElementById("formContent")),n.disabled=!1,s.disabled=!0,!1))),n.addEventListener("click",(e=>(e.preventDefault(),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")),s.disabled=!1,n.disabled=!0,!1))),ReactDOM.render(React.createElement(m,null),document.getElementById("formContent")))}},795:(e,t,s)=>{"use strict";s.r(t),s.d(t,{setShape:()=>Rt,startGameLogic:()=>rt});const n=[["#000000","#111111","#222222","#333333","#444444","#555555","#666666","#777777","#888888","#999999","#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee","#ffffff"].reverse(),["rgb(247,100,29)","rgb(235,110,29)","rgb(223,120,39)","rgb(211,130,49)","rgb(199,140,59)","rgb(187,150,69)","rgb(175,160,79)","rgb(163,170,89)","rgb(151,180,99)","rgb(139,190,109)","rgb(127,200,119)","rgb(115,210,129)","rgb(102,220,139)","rgb(90,230,149)","rgb(78,240,159)","rgb(66, 250, 169)"],["rgb(160,80,0)","rgb(150,75,10)","rgb(140,70,20)","rgb(130,65,30)","rgb(120,60,40)","rgb(110,55,50)","rgb(100,50,60)","rgb(90,45,70)","rgb(80,40,80)","rgb(70,35,90)","rgb(60,30,100)","rgb(50,25,110)","rgb(40,20,120)","rgb(30,15,130)","rgb(20,10,140)","rgb(10, 5, 150)"]],a=3*Math.PI/2,r=-Math.PI/2,o=(e,t,s,n,o=!0,i=0)=>{const l=e.x+t,c=e.y+s;switch(o&&n.clearRect(0,0,640,480),n.save(),n.translate(l,c),n.beginPath(),1===e.g&&n.rotate(Math.PI/2),e.shape){case 0:default:n.arc(0,-3*e.scale,3,r,a);break;case 1:case 2:n.arc(0,-3*e.scale,Math.abs(3*e.scale),r,a);break;case 3:n.rect(0,0,5*e.scale,5*e.scale);break;case 4:n.rect(-3*e.scale,-6*e.scale,6*e.scale,6*e.scale)}const u=(2+i)*e.scale;n.moveTo(0,-e.scale),n.lineTo(0,5*e.scale),n.lineTo(-u,8*e.scale),n.moveTo(0,5*e.scale),n.lineTo(u,8*e.scale),n.moveTo(-3*e.scale,3*e.scale),n.lineTo(3*e.scale,3*e.scale),n.closePath(),e.color&&(n.strokeStyle=e.color),n.stroke(),n.restore()},i=(e,t,s,n,a,r,o=!0,i=!1,l="black")=>{a.save(),a.beginPath(),a.moveTo(e,t),a.lineTo(e+s,t),a.lineTo(e+s,t+n),a.lineTo(e,t+n),a.closePath(),i?(a.fillStyle=r,a.strokeStyle=l,a.fill(),a.stroke()):o?(a.fillStyle=r,a.fill()):(a.strokeStyle=r,a.lineWidth=3,a.stroke()),a.restore()};var l=s(477),c=s(689);const u=async(e,t)=>{const s={username:e,item:t,_csrf:document.querySelector("#_csrf").value};await fetch("/updateItems",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})};class d extends l.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new y(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new S(e)})),this.register((function(e){return new E(e)})),this.register((function(e){return new w(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new T(e)})),this.register((function(e){return new R(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new M(e)}))}load(e,t,s,n){const a=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:l.Zp0.extractUrlBase(e),this.manager.itemStart(e);const o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},i=new l.hH6(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(s){try{a.parse(s,r,(function(s){t(s),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),s,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let a;const r={},o={};if("string"==typeof e)a=e;else if(l.Zp0.decodeText(new Uint8Array(e,0,4))===_){try{r[h.KHR_BINARY_GLTF]=new A(e)}catch(e){return void(n&&n(e))}a=r[h.KHR_BINARY_GLTF].content}else a=l.Zp0.decodeText(new Uint8Array(e));const i=JSON.parse(a);if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new J(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);o[t.name]=t,r[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],s=i.extensionsRequired||[];switch(t){case h.KHR_MATERIALS_UNLIT:r[t]=new f;break;case h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[t]=new C;break;case h.KHR_DRACO_MESH_COMPRESSION:r[t]=new I(i,this.dracoLoader);break;case h.KHR_TEXTURE_TRANSFORM:r[t]=new P;break;case h.KHR_MESH_QUANTIZATION:r[t]=new k;break;default:s.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(r),c.setPlugins(o),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise((function(n,a){s.parse(e,t,n,a)}))}}function m(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class p{constructor(e){this.parser=e,this.name=h.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const a=t.json,r=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const i=new l.Ilk(16777215);void 0!==r.color&&i.fromArray(r.color);const c=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new l.Ox3(i),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new l.cek(i),o.distance=c;break;case"spot":o=new l.PMe(i),o.distance=c,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,void 0!==r.intensity&&(o.intensity=r.intensity),o.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(o),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return s._getNodeRef(t.cache,a,e)}))}}class f{constructor(){this.name=h.KHR_MATERIALS_UNLIT}getMaterialType(){return l.vBJ}extendParams(e,t,s){const n=[];e.color=new l.Ilk(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&n.push(s.assignTexture(e,"map",a.baseColorTexture,l.knz))}return Promise.all(n)}}class g{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class y{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&a.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(a.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.FM8(e,e)}return Promise.all(a)}}class R{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&a.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&a.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(a)}}class E{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new l.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];return void 0!==r.sheenColorFactor&&t.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&a.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,l.knz)),void 0!==r.sheenRoughnessTexture&&a.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}}class w{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&a.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class v{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&a.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const o=r.attenuationColor||[1,1,1];return t.attenuationColor=new l.Ilk(o[0],o[1],o[2]),Promise.all(a)}}class x{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class T{constructor(e){this.parser=e,this.name=h.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?l.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&a.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return t.specularColor=new l.Ilk(o[0],o[1],o[2]),void 0!==r.specularColorTexture&&a.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,l.knz)),Promise.all(a)}}class b{constructor(e){this.parser=e,this.name=h.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,r)}}class S{constructor(e){this.parser=e,this.name=h.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],o=n.images[r.source];let i=s.textureLoader;if(o.uri){const e=s.options.manager.getHandler(o.uri);null!==e&&(i=e)}return this.detectSupport().then((function(a){if(a)return s.loadTextureImage(e,r.source,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class M{constructor(e){this.name=h.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,a.ready]).then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,i=new ArrayBuffer(r*o),l=new Uint8Array(t[0],s,n);return a.decodeGltfBuffer(new Uint8Array(i),r,o,l,e.mode,e.filter),i}))}return null}}const _="glTF";class A{constructor(e){this.name=h.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:l.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==_)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<s;){const t=n.getUint32(a,!0);a+=4;const s=n.getUint32(a,!0);if(a+=4,1313821514===s){const s=new Uint8Array(e,12+a,t);this.content=l.Zp0.decodeText(s)}else if(5130562===s){const s=12+a;this.body=e.slice(s,s+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class I{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=h.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},i={},l={};for(const e in r){const t=j[e]||e.toLowerCase();o[t]=r[e]}for(const t in e.attributes){const n=j[t]||t.toLowerCase();if(void 0!==r[t]){const a=s.accessors[e.attributes[t]],r=F[a.componentType];l[n]=r,i[n]=!0===a.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=i[t];void 0!==n&&(s.normalized=n)}t(e)}),o,l)}))}))}}class P{constructor(){this.name=h.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class L extends l.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new l.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class C{constructor(){this.name=h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return L}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new l.Ilk(1,1,1),e.opacity=1;const a=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&a.push(s.assignTexture(e,"map",n.diffuseTexture,l.knz)),e.emissive=new l.Ilk(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new l.Ilk(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;a.push(s.assignTexture(e,"glossinessMap",t)),a.push(s.assignTexture(e,"specularMap",t,l.knz))}return Promise.all(a)}createMaterial(e){const t=new L(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=l.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class k{constructor(){this.name=h.KHR_MESH_QUANTIZATION}}class O extends l._C8{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let e=0;e!==n;e++)t[e]=s[a+e];return t}}O.prototype.interpolate_=function(e,t,s,n){const a=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=2*o,l=3*o,c=n-t,u=(s-t)/c,d=u*u,m=d*u,h=e*l,p=h-l,f=-2*m+3*d,g=m-d,y=1-f,R=g-d+u;for(let e=0;e!==o;e++){const t=r[p+e+o],s=r[p+e+i]*c,n=r[h+e+o],l=r[h+e]*c;a[e]=y*t+R*s+f*n+g*l}return a};const N=new l._fP;class H extends O{interpolate_(e,t,s,n){const a=super.interpolate_(e,t,s,n);return N.fromArray(a).normalize().toArray(a),a}}const F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},D={9728:l.TyD,9729:l.wem,9984:l.YLQ,9985:l.qyh,9986:l.aH4,9987:l.D1R},B={33071:l.uWy,33648:l.OoA,10497:l.rpg},U={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:void 0,LINEAR:l.NMF,STEP:l.Syv};function V(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function q(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function X(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function W(e){const t=e.extensions&&e.extensions[h.KHR_DRACO_MESH_COMPRESSION];let s;return s=t?"draco:"+t.bufferView+":"+t.indices+":"+z(t.attributes):e.indices+":"+z(e.attributes)+":"+e.mode,s}function z(e){let t="";const s=Object.keys(e).sort();for(let n=0,a=s.length;n<a;n++)t+=s[n]+":"+e[s[n]]+";";return t}function Y(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class J{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new m,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,a=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||s||n&&a<98?this.textureLoader=new l.dpR(this.options.manager):this.textureLoader=new l.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};V(a,r,n),q(r,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(s[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),a=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,n]of e.children.entries())a(n,t.children[s])};return a(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&s.push(a)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){s.load(l.Zp0.resolveURL(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const a=[];return void 0!==n.bufferView?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),void 0!==n.sparse&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],r=U[n.type],o=F[n.componentType],i=o.BYTES_PER_ELEMENT,c=i*r,u=n.byteOffset||0,d=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,m=!0===n.normalized;let h,p;if(d&&d!==c){const e=Math.floor(u/d),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(s);c||(h=new o(a,e*d,n.count*d/i),c=new l.vpT(h,d/i),t.cache.add(s,c)),p=new l.kB5(c,r,u%d/i,m)}else h=null===a?new o(n.count*r):new o(a,u,n.count*r),p=new l.TlE(h,r,m);if(void 0!==n.sparse){const t=U.SCALAR,s=F[n.sparse.indices.componentType],i=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,u=new s(e[1],i,n.sparse.count*t),d=new o(e[2],c,n.sparse.count*r);null!==a&&(p=new l.TlE(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(p.setX(t,d[e*r]),r>=2&&p.setY(t,d[e*r+1]),r>=3&&p.setZ(t,d[e*r+2]),r>=4&&p.setW(t,d[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,a=t.images[n];let r=this.textureLoader;if(a.uri){const e=s.manager.getHandler(a.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,s){const n=this,a=this.json,r=a.textures[e],o=a.images[t],i=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[i])return this.textureCache[i];const c=this.loadImageSource(t,s).then((function(t){t.flipY=!1,r.name&&(t.name=r.name);const s=(a.samplers||{})[r.sampler]||{};return t.magFilter=D[s.magFilter]||l.wem,t.minFilter=D[s.minFilter]||l.D1R,t.wrapS=B[s.wrapS]||l.rpg,t.wrapT=B[s.wrapT]||l.rpg,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[i]=c,c}loadImageSource(e,t){const s=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const a=s.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",i=!1;if(void 0!==a.bufferView)o=this.getDependency("bufferView",a.bufferView).then((function(e){i=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o}));else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then((function(e){return new Promise((function(s,a){let r=s;!0===t.isImageBitmapLoader&&(r=function(e){const t=new l.xEZ(e);t.needsUpdate=!0,s(t)}),t.load(l.Zp0.resolveURL(e,n.path),r,void 0,a)}))})).then((function(e){var t;return!0===i&&r.revokeObjectURL(o),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,s,n){const a=this;return this.getDependency("texture",s.index).then((function(r){if(void 0===s.texCoord||0==s.texCoord||"aoMap"===t&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),a.extensions[h.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[h.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(r);r=a.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),a.associations.set(r,t)}}return void 0!==n&&(r.encoding=n),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new l.UY4,l.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new l.nls,l.F5T.prototype.copy.call(t,s),t.color.copy(s.color),this.cache.add(e,t)),s=t}if(n||a||r){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return l.Wid}loadMaterial(e){const t=this,s=this.json,n=this.extensions,a=s.materials[e];let r;const o={},i=a.extensions||{},c=[];if(i[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=e.getMaterialType(),c.push(e.extendParams(o,a,t))}else if(i[h.KHR_MATERIALS_UNLIT]){const e=n[h.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),c.push(e.extendParams(o,a,t))}else{const s=a.pbrMetallicRoughness||{};if(o.color=new l.Ilk(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;o.color.fromArray(e),o.opacity=e[3]}void 0!==s.baseColorTexture&&c.push(t.assignTexture(o,"map",s.baseColorTexture,l.knz)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(c.push(t.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=l.ehD);const u=a.alphaMode||"OPAQUE";if("BLEND"===u?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===u&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==l.vBJ&&(c.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new l.FM8(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;o.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&r!==l.vBJ&&(c.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==l.vBJ&&(o.emissive=(new l.Ilk).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==l.vBJ&&c.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,l.knz)),Promise.all(c).then((function(){let s;return s=r===L?n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),a.name&&(s.name=a.name),q(s,a),t.associations.set(s,{materials:e}),a.extensions&&V(n,s,a),s}))}createUniqueName(e){const t=l.iUV.sanitizeNodeName(e||"");let s=t;for(let e=1;this.nodeNamesUsed[s];++e)s=t+"_"+e;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function a(e){return s[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return Z(s,e,t)}))}const r=[];for(let s=0,o=e.length;s<o;s++){const o=e[s],i=W(o),c=n[i];if(c)r.push(c.promise);else{let e;e=o.extensions&&o.extensions[h.KHR_DRACO_MESH_COMPRESSION]?a(o):Z(new l.u9r,o,t),n[i]={primitive:o,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,a=s.meshes[e],r=a.primitives,o=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new l.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.Wl3})),i.DefaultMaterial):this.getDependency("material",r[e].material);o.push(t)}var i;return o.push(t.loadGeometries(r)),Promise.all(o).then((function(s){const o=s.slice(0,s.length-1),i=s[s.length-1],c=[];for(let s=0,u=i.length;s<u;s++){const u=i[s],d=r[s];let m;const h=o[s];if(4===d.mode||5===d.mode||6===d.mode||void 0===d.mode)m=!0===a.isSkinnedMesh?new l.TUv(u,h):new l.Kj0(u,h),!0!==m.isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),5===d.mode?m.geometry=Q(m.geometry,l.UlW):6===d.mode&&(m.geometry=Q(m.geometry,l.z$h));else if(1===d.mode)m=new l.ejS(u,h);else if(3===d.mode)m=new l.x12(u,h);else if(2===d.mode)m=new l.blk(u,h);else{if(0!==d.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);m=new l.woe(u,h)}Object.keys(m.geometry.morphAttributes).length>0&&X(m,a),m.name=t.createUniqueName(a.name||"mesh_"+e),q(m,a),d.extensions&&V(n,m,d),t.assignFinalMaterial(m),c.push(m)}for(let s=0,n=c.length;s<n;s++)t.associations.set(c[s],{meshes:e,primitives:s});if(1===c.length)return c[0];const u=new l.ZAu;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(n)return"perspective"===s.type?t=new l.cPb(l.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new l.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),q(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))}loadAnimation(e){const t=this.json.animations[e],s=[],n=[],a=[],r=[],o=[];for(let e=0,i=t.channels.length;e<i;e++){const i=t.channels[e],l=t.samplers[i.sampler],c=i.target,u=void 0!==c.node?c.node:c.id,d=void 0!==t.parameters?t.parameters[l.input]:l.input,m=void 0!==t.parameters?t.parameters[l.output]:l.output;s.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",m)),r.push(l),o.push(c)}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(a),Promise.all(r),Promise.all(o)]).then((function(s){const n=s[0],a=s[1],r=s[2],o=s[3],i=s[4],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=a[e],u=r[e],d=o[e],m=i[e];if(void 0===t)continue;let h;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,G[m.path]){case G.weights:h=l.dUE;break;case G.rotation:h=l.iLg;break;default:h=l.yC1}const p=t.name?t.name:t.uuid,f=void 0!==d.interpolation?K[d.interpolation]:l.NMF,g=[];G[m.path]===G.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(p);let y=u.array;if(u.normalized){const e=Y(y.constructor),t=new Float32Array(y.length);for(let s=0,n=y.length;s<n;s++)t[s]=y[s]*e;y=t}for(let e=0,t=g.length;e<t;e++){const t=new h(g[e]+"."+G[m.path],s.array,y,f);"CUBICSPLINE"===d.interpolation&&(t.createInterpolant=function(e){return new(this instanceof l.iLg?H:O)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=t.name?t.name:"animation_"+e;return new l.m7l(u,void 0,c)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,s=this.extensions,n=this,a=t.nodes[e],r=a.name?n.createUniqueName(a.name):"";return function(){const t=[],s=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&t.push(s),void 0!==a.camera&&t.push(n.getDependency("camera",a.camera).then((function(e){return n._getNodeRef(n.cameraCache,a.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let o;if(o=!0===a.isBone?new l.N$j:t.length>1?new l.ZAu:1===t.length?t[0]:new l.Tme,o!==t[0])for(let e=0,s=t.length;e<s;e++)o.add(t[e]);if(a.name&&(o.userData.name=a.name,o.name=r),q(o,a),a.extensions&&V(s,o,a),void 0!==a.matrix){const e=new l.yGw;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}))}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],a=this,r=new l.ZAu;n.name&&(r.name=a.createUniqueName(n.name)),q(r,n),n.extensions&&V(s,r,n);const o=n.nodes||[],i=[];for(let e=0,s=o.length;e<s;e++)i.push($(o[e],r,t,a));return Promise.all(i).then((function(){return a.associations=(e=>{const t=new Map;for(const[e,s]of a.associations)(e instanceof l.F5T||e instanceof l.xEZ)&&t.set(e,s);return e.traverse((e=>{const s=a.associations.get(e);null!=s&&t.set(e,s)})),t})(r),r}))}}function $(e,t,s,n){const a=s.nodes[e];return n.getDependency("node",e).then((function(e){if(void 0===a.skin)return e;let t;return n.getDependency("skin",a.skin).then((function(e){t=e;const s=[];for(let e=0,a=t.joints.length;e<a;e++)s.push(n.getDependency("node",t.joints[e]));return Promise.all(s)})).then((function(s){return e.traverse((function(e){if(!e.isMesh)return;const n=[],a=[];for(let e=0,r=s.length;e<r;e++){const r=s[e];if(r){n.push(r);const s=new l.yGw;void 0!==t.inverseBindMatrices&&s.fromArray(t.inverseBindMatrices.array,16*e),a.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new l.OdW(n,a),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(a.children){const t=a.children;for(let a=0,o=t.length;a<o;a++){const o=t[a];r.push($(o,e,s,n))}}return Promise.all(r)}))}function Z(e,t,s){const n=t.attributes,a=[];function r(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const s=j[t]||t.toLowerCase();s in e.attributes||a.push(r(n[t],s))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(n)}return q(e,t),function(e,t,s){const n=t.attributes,a=new l.ZzF;if(void 0===n.POSITION)return;{const e=s.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new l.Pa4(t[0],t[1],t[2]),new l.Pa4(r[0],r[1],r[2])),e.normalized){const t=Y(F[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new l.Pa4,t=new l.Pa4;for(let n=0,a=r.length;n<a;n++){const a=r[n];if(void 0!==a.POSITION){const n=s.json.accessors[a.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const e=Y(F[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const o=new l.aLr;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,a=!1,r=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(a=!0),void 0!==s.COLOR_0&&(r=!0),n&&a&&r)break}if(!n&&!a&&!r)return Promise.resolve(e);const o=[],i=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(n){const t=void 0!==u.POSITION?s.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(a){const t=void 0!==u.NORMAL?s.getDependency("accessor",u.NORMAL):e.attributes.normal;i.push(t)}if(r){const t=void 0!==u.COLOR_0?s.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(l)]).then((function(t){const s=t[0],o=t[1],i=t[2];return n&&(e.morphAttributes.position=s),a&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}function Q(e,t){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const n=s.count-2,a=[];if(t===l.z$h)for(let e=1;e<=n;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(a),r}let ee,te,se,ne,ae,re,oe=l.Tme,ie=l.Tme,le=!1,ce=[0,0],ue=!1;const de=[];let me,he=!1,pe={},fe=!0,ge={};const ye={},Re={screwattack:{obtained:!1,collected:Tt,draw:e=>{_e(e)},collide:e=>{be(e)}},morphball:{obtained:!1,collected:xt,draw:e=>{_e(e)},collide:e=>{be(e)}},yellowswitch:{collected:_t,draw:e=>{_e(e)},collide:e=>{xe(e)}},redswitch:{collected:function(){for(let e=c.specialObjects.length-1;e>=0;e--)"fire"===c.specialObjects[e].id&&c.specialObjects.splice(e,1)},draw:e=>{_e(e)}},greyswitch:{collected:()=>{ue=!0,console.log("Hello")},draw:e=>{_e(e)},collide:e=>{be(e)}},fire:{collected:xt,draw:e=>{Ee(e)},collide:e=>{ve(e)}},hflip:{collected:vt,draw:e=>{_e(e)},collide:e=>{be(e)}},mouse:{collected:St,draw:e=>{_e(e)},collide:e=>{be(e)}},eyes:{collected:bt,draw:e=>{_e(e)},collide:e=>{be(e)}},checkpoint:{draw:e=>{Me(e)},collide:e=>{Te(e)}},"3DPerson":{draw:e=>{Se(e)}},"3DComp":{draw:e=>{Se(e)}},"3DArrow":{draw:e=>{Se(e)},collected:vt,collide:e=>{vt()}}},Ee=e=>{ft(Ae,e)&&((e,t,s,a,r,o=0)=>{r.save();let i=Math.floor(o),l=1;r.fillStyle=n[2][i],r.fillRect(e,t,s,a);for(let o=6;o>=3;o-=1){i+=l,i>14?l=-1:i<1&&(l=1),r.fillStyle=n[2][Math.floor(i)];const c=1-2/o;r.fillRect(e+s/o,t+a/o,s*c,a*c)}r.restore()})(e.x+nt,e.y+at,e.width,e.height,te,Ue)};let we=!1;const ve=()=>{if(console.log(`mouse: ${We} and prevCollWithFire: ${we}`),!0===We&&!1===we){we=!0;let e=Params.prototype.fromJSON({oldParams:!0,wave_type:0,p_env_attack:-3653593375929631e-20,p_env_sustain:.5159887075424194,p_env_punch:.43771442770957947,p_env_decay:-.5177679657936096,p_base_freq:.4211834669113159,p_freq_limit:0,p_freq_ramp:.09771327674388885,p_freq_dramp:.18222975730895996,p_vib_strength:.29777976870536804,p_vib_speed:.8540940284729004,p_arp_mod:.3622890114784241,p_arp_speed:-.032950595021247864,p_duty:-.44415274262428284,p_duty_ramp:-.6385311484336853,p_repeat_speed:.07904504984617233,p_pha_offset:.050250060856342316,p_pha_ramp:.3983093798160553,p_lpf_freq:.5602583885192871,p_lpf_ramp:-.0018845867598429322,p_lpf_resonance:-.17684580385684967,p_hpf_freq:2.0634999486901506e-8,p_hpf_ramp:.11631236225366592,sound_vol:.25,sample_rate:44100,sample_size:8});return e.mutate(),sfxr.toAudio(e).play(),setTimeout((e=>{we=!1}),1e3),he=!he,void(!0===he?(me=de,Ke=1,Ve=2):(me=c.rects,Ke=3,Ve=5))}if(!0===we)return;Je=!1,Fe.play();const e=Ae.color;Ae.color="red",setTimeout((t=>{Je=!0,Mt(),Ae.color=e}),500)},xe=e=>{0===Ae.g&&!1===Ae.flip&&(c.specialObjects.splice(c.specialObjects.indexOf(e),1),Re.yellowswitch.collected())},Te=e=>{if(!e.active){e.color="yellow",ge.active=!1,ge.color="",Ae.spawn=[e.x+e.width/2,e.y-8],ge=e;const t=sfxr.generate("explosion");sfxr.play(t)}e.active=!0},be=e=>{Re[e.name].collected(),c.specialObjects.splice(c.specialObjects.indexOf(e),1)},Se=e=>{i(e.x+nt,e.y+at,25,25,te,"orange",!0),ft(Ae,e)&&(shouldDraw3DObjs=!0,le||(ne.add(Re[e.name].file),le=Re[e.name].file,ce=[e.x-320,240-e.y]))},Me=e=>{let t="gray";e.color&&(t=e.color);let s=1;switch(e.values.dir){case 0:default:i(e.x+nt,e.y+25+at,e.width,e.height,te,t,!1,!0);break;case 1:i(e.x+nt+25,e.y+at,e.width,e.height,te,t,!1,!0);break;case 2:i(e.x+nt,e.y-25+at,e.width,e.height,te,t,!1,!0),s=-1;break;case 3:i(e.x+nt-25,e.y+at,e.width,e.height,te,t,!1,!0)}if(e.active){const t=e.y+at+25*s+e.height/2;te.beginPath(),te.setLineDash([3]),te.moveTo(e.x+nt,t),te.lineTo(e.x+nt+e.width,t),te.strokeStyle="black",te.closePath(),te.stroke(),te.setLineDash([])}},_e=e=>{te.drawImage(ye[e.name],e.x+nt,e.y-e.originY+at)},Ae={x:838,y:200,halfWidth:4,halfHeight:7,newX:825,newY:200,scale:1,name:"",flip:!1,g:0,spawn:[838,200]};let Ie,Pe,Le,Ce,ke,Oe,Ne,He,Fe,De=0,Be=0,Ue=0,je=0,Ge=!0,Ke=3,Ve=5,qe=!0,Xe=!1,We=!1,ze=!1,Ye=!1,Je=!0,$e=!1,Ze=!1,Qe=!1,et=5e3,tt=[],st=0;let nt=-538,at=100;const rt=(e,t=!1)=>{e&&e.username&&e.items&&e.color&&e.shape>=0&&(Ae.name=e.username,De=e.color,Ae.shape=e.shape,e.items&&yt(e.items),what_is_my_name="uh... "+e.username),pe.name=Ae.name,pe.color=De,pe.movement=[],Ce=new Audio("assets/sound/buttonClick.wav"),ke=new Audio("assets/sound/itemGet.wav"),ke=new Audio("assets/sound/itemGet.wav"),Fe=new Audio("assets/sound/explosion.wav"),Oe=new Audio("assets/sound/the-earth.mp3"),Oe.volume=.25,Ne=new Audio("assets/sound/warp-whistle.mp3"),Ne.volume=.3,He=new Audio("assets/sound/world-sky.mp3"),He.volume=.25,t?document.addEventListener("click",(e=>{Oe.loop=!0}),{once:!0}):Oe.loop=!0;let s=document.querySelector("#canvas_player"),n=document.querySelector("#canvas_walkers"),a=document.querySelector("#canvas_bg"),r=document.querySelector("#canvas_js3");document.getElementById("resetBtn").onmousedown=e=>{e.preventDefault(),Mt()},ee=n.getContext("2d"),te=s.getContext("2d"),se=a.getContext("2d"),ne=new l.xsS,re=new l.cPb(40,1.3333333333333333,.1,1e3),re.position.set(0,0,10),re.lookAt(0,0,0),ae=new l.CP7({canvas:r,alpha:!0}),ae.setClearColor(0,0);const o=new l.Mig(16777215);ne.add(o);const i=new l.Ox3(16777215,.5);ne.add(i),re.position.z=100;const u=new d;u.load("assets/img/character.glb",(function(e){oe=e.scene,oe.scale.x=oe.scale.y=oe.scale.z=1,e.scene.name="3DPerson",Re["3DPerson"].file=e.scene}),void 0,(function(e){console.error(e)})),u.load("assets/img/arrowright.glb",(function(e){e.scene.scale.set(.25,.25,1),e.scene.position.x+=2,e.scene.position.y+=2,e.scene.name="3DArrow",Re["3DArrow"].file=e.scene}),void 0,(function(e){console.error(e)})),u.load("assets/img/SavePc.glb",(function(e){ie=e.scene,ie.scale.x=ie.scale.y=ie.scale.z=9,ie.rotation.y=-Math.PI,ie.rotation.x=-.25,e.scene.name="3DComp",Re["3DComp"].file=e.scene,ie.position.y-=30}),void 0,(function(e){console.error(e)})),Pe=n.width,Le=n.height,document.addEventListener("keydown",At),document.addEventListener("keyup",It),c.clouds&&c.clouds.length>0&&c.clouds.forEach((e=>{de.push(new c.bgRect(630*Math.random()+5,470*Math.random()+5,10*Math.random()+30,4*Math.random()+3,e))}));for(let e=0;e<10;e++)de.push(new c.bgRect(640*Math.random(),480*Math.random(),10*Math.random()+30,4*Math.random()+10,"rgba(0,0,0,0.3)"));me=c.rects,mt(),ee.fillStyle="black",setInterval(ot,1e3/60),setInterval(mt,1e3/15)},ot=()=>{var e,t,s;!Ye&&Je?(ct(),o(Ae,nt,at,te,void 0,je),Qe&&(et-=17,et>0?Ae.flip?i(Ae.x-16+nt,Ae.y-12+at,8,et/200,te,"orange",!1,!0):i(Ae.x+10+nt,Ae.y-12+at,8,et/200,te,"orange",!1,!0):function(){const e=sfxr.generate("jump");e.sound_vol=.1,sfxr.play(e),Ae.g=0,Ae.halfWidth=4,Ae.halfHeight=7,Ae.flip=!1,Ae.scale=Math.abs(Ae.scale),Qe=!1}())):Ye&&(_t(),Je&&(it(),te.clearRect(0,0,640,480),te.save(),te.scale(2,2),te.drawImage(ye.uni,-320+nt,-240+at),te.restore(),e=Ie,s=nt,(t=te).save(),t.translate(e.x+s,e.y),t.rotate(e.dirRad),t.beginPath(),t.moveTo(-e.halfWidth,-e.halfHeight),t.lineTo(e.halfWidth,-e.halfHeight),t.lineTo(e.halfWidth,e.halfHeight),t.lineTo(-e.halfWidth,e.halfHeight),t.closePath(),t.fillStyle=e.color,t.fill(),t.stroke(),t.restore())),ut()},it=()=>{tt[65]&&(Ie.dirRad+=.01),tt[68]&&(Ie.dirRad-=.01),Ie.hSpeed=Math.cos(Ie.dirRad),Ie.vSpeed=Math.sin(Ie.dirRad),Ie.x+=Ie.hSpeed/2,Ie.y+=Ie.vSpeed/2,Ie.y>Le+20?Ie.y=-20:Ie.y<-20&&(Ie.y=Le+20),nt-=Ie.hSpeed/5,at-=Ie.vSpeed/5};let lt=!1;const ct=()=>{let e=0,t=0,s=!1;ze&&tt[16]?(tt[65]&&(nt+=2),tt[68]&&(nt-=2),tt[87]&&(at+=2),tt[83]&&(at-=2)):0===Ae.g?(tt[65]&&(e=-Ke,s=!0),tt[68]&&(e=Ke,s=!0),t=Ae.flip?-Ve:Ve):1===Ae.g&&(tt[87]&&(t=-Ke,s=!0),tt[83]&&(t=Ke,s=!0),e=Ae.flip?Ve:-Ve),ze&&tt[82]&&(nt=300-Ae.x,at=300-Ae.y),Ae.newX=Ae.x+e,Ae.newY=Ae.y+t;let n=ht(Ae,e,t);if(n[0]?(he||(nt+=Ae.x-Ae.newX,at+=Ae.y-Ae.newY),Ae.x=Ae.newX,Ae.y=Ae.newY):(Ae.x+=e,Ae.y+=t,he||(nt-=e,at-=t)),he&&(Ae.x+nt>Pe+20?Ae.x-=Pe+20:Ae.x+nt<-20&&(Ae.x+=Pe+20),Ae.y+at>Le+20?Ae.y-=Le+20:Ae.y+at<-20&&(Ae.y+=Le+20)),!1===lt&&!0===n[1]){const e=sfxr.generate("click");e.sound_vol=.1,sfxr.play(e)}lt=n[1],Et(s,n[1]),gt(Ae)},ut=()=>{c.rects.forEach((e=>{i(e.x+nt,e.y+at,e.width,e.height,te,e.values.color,!0,!1)}));let e=!1;c.specialObjects.forEach((t=>{"3D"===t.name.substring(0,2)?(i(t.x+nt,t.y+at,t.width,t.height,te,"orange",!1),ft(Ae,t)&&(e=!0,le!==t.name&&(ne.remove(le),le=!1),!le&&Re[t.name].file&&(ne.add(Re[t.name].file),le=Re[t.name].file,ce=[t.x-320,240-t.y]))):Re[t.name].draw(t)})),e?(ae.setViewport(ce[0]+nt,ce[1]-at,640,480),ue&&(ie.rotation.y<=0?ie.rotation.y+=.01:ue=!1),ne.rotation.x=Math.sin(je/12)+Math.PI,ae.render(ne,re)):!1!==le&&(ne.remove(le),le=!1)};let dt=.4;const mt=()=>{se.clearRect(0,0,640,480),Ue+=dt,Ue>14.5?dt=-2:Ue<.5&&(dt=2),i(0,0,Pe,Le,se,"white",!0),st+=0,de.forEach((function(e){e.x+=e.hSpeed,e.y+=e.vSpeed,fe&&(e.x>Pe+20?e.x=-20:e.x<-20&&(e.x=Pe+20),e.y>Le+20?e.y=-20:e.y<-20&&(e.y=Le+20)),i(e.x,e.y,e.width,e.height,se,e.color,!0)}))},ht=(e,t,s)=>{let n=e,a=[!1,!1];return he&&(n={...e},n.x+=nt,n.y-=at,n.newX+=nt,n.newY-=at),me.forEach((r=>{pt(n,r)&&(a[0]=!0,((e,t)=>e.y+(e.halfHeight-1)<t.y&&e.newY+(e.halfHeight+1)>=t.y)(n,r)||((e,t)=>e.y-(e.halfHeight-2)>=t.y+t.height&&e.newY-(e.halfHeight+2)<t.y+t.height)(n,r)?(e.newY-=s,0===n.g&&(Xe||(qe=!0),a[1]=!0)):(((e,t)=>e.x-(e.halfWidth-2)>=t.x+t.width&&e.newX-(e.halfWidth+2)<t.x+t.width)(n,r)||((e,t)=>e.x+(e.halfWidth-2)<=t.x&&e.newX+(e.halfWidth+2)>=t.x)(n,r))&&(e.newX-=t,1===n.g&&(Xe||(qe=!0),a[1]=!0)))})),a},pt=(e,t)=>e.newX-e.halfWidth<t.x+t.width&&e.newX+e.halfWidth>t.x&&e.newY-e.halfHeight<t.y+t.height&&e.newY+e.halfHeight>t.y,ft=(e,t)=>e.newX-e.halfWidth<t.x+550&&e.newX+e.halfWidth>t.x-550&&e.newY-e.halfHeight<t.y+500&&e.newY+e.halfHeight>t.y-500,gt=e=>{c.specialObjects.forEach((t=>{pt(e,t)&&("3D"===t.name.substring(0,2)&&"3DArrow"!==t.name||Re[t.name].collide(t))}))},yt=e=>{ye.screwattack=document.getElementById("screwattack"),ye.morphball=document.getElementById("morphball"),ye.greyswitch=document.getElementById("greyswitch"),ye.yellowswitch=document.getElementById("yellowswitch"),ye.redswitch=document.getElementById("redswitch"),ye.hflip=document.getElementById("hflip"),ye.uni=document.getElementById("uni"),ye.mouse=document.getElementById("mouse"),ye.eyes=document.getElementById("eyes"),!0===e.morphball&&xt(!1),!0===e.screwattack&&Tt(!1),!0===e.mouse&&St(!1),!0===e.eyes&&bt(!1)},Rt=(e=0)=>{Ae.shape=e,Ae.scale=1===e?2:2===e?.5:1},Et=(e=!1,t=!1)=>{e&&t?Ge?(je+=.25,je>=2&&(Ge=!1)):(je-=.25,je<=-2&&(Ge=!0)):0!==je&&(je+=0-je)};let wt=!0;function vt(){if(Ae.g=1,Ae.halfHeight=4,Ae.halfWidth=7,Ae.flip=!0,Ae.scale=-1*Math.abs(Ae.scale),Qe=!0,et=5e3,wt){const e=sfxr.generate("powerUp");sfxr.play(e),wt=!1,setTimeout((()=>{wt=!0}),100)}}function xt(e=!0){document.getElementById("morphball").classList.remove("noDisplay"),document.getElementById("morphball").classList.add("inline"),document.getElementById("moveInstructions").innerHTML="Use '<strong>A</strong>', '<strong>D</strong>', and '<strong>W</strong>' to move, ",$e=!0,Ze=!0,!0===e&&(u(Ae.name,"morphball"),ke.play())}function Tt(e=!0){document.getElementById("screwattack").classList.remove("noDisplay"),document.getElementById("screwattack").classList.add("inline"),document.getElementById("spaceInstructions").innerHTML="<strong>&nbsp;SPACE</strong> to ultra flip",Xe=!0,!0===e&&(u(Ae.name,"screwattack"),ke.play())}function bt(e=!0){document.getElementById("eyes").classList.remove("noDisplay"),document.getElementById("eyes").classList.add("inline"),document.getElementById("moveInstructions").innerHTML="Use '<strong>A</strong>', '<strong>D</strong>', and '<strong>W</strong>' to move (hold <strong>SHIFT</strong>),",ze=!0,!0===e&&(u(Ae.name,"eyes"),ke.play())}function St(e=!0){document.getElementById("mouse").classList.remove("noDisplay"),document.getElementById("mouse").classList.add("inline"),document.getElementById("moveInstructions").innerHTML="Use '<strong>A</strong>', '<strong>D</strong>', and '<strong>W</strong>' to move (hold <strong>SHIFT</strong>), click mouse",We=!0,!0===e&&(u(Ae.name,"mouse"),ke.play())}const Mt=()=>{Ae.x=Ae.spawn[0],Ae.y=Ae.spawn[1],Ae.flip=!1,Ae.scale=Math.abs(Ae.scale),Ae.newX=300,Ae.newY=300,nt=300-Ae.x,at=300-Ae.y};function _t(){Ye||(Je=!1,Ie=new c.bgRect(Ae.x,-20,10*Math.random()+30,4*Math.random()+3,De),Ie.dirRad=Math.PI/2,Ie.halfWidth=Ie.width/2,Ie.halfHeight=Ie.height/2,Oe.pause(),Ne.play(),document.getElementById("resetBtn").disabled=!0,setTimeout((()=>{He.play(),Je=!0,fe=!1,He.addEventListener("timeupdate",(e=>{He.currentTime>He.duration-.12&&(He.currentTime=0,He.play())}))}),4e3),Ye=!0),Be<254&&(Be+=.2,Ae.y+=.85),Ae.color=`#000000${(255-Be).toString(16).substring(0,2)}`,o(Ae,nt,at,te,!0,0),de.forEach((e=>{e.color=`rgba(${Be}, ${Be}, ${Be}, 0.1)`})),Ie.color=`${De}${Be.toString(16).substring(0,2)}`,c.rects.forEach((e=>{e.color=`rgba(${Be}, ${Be}, ${Be}, 0.5)`}))}const At=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:tt[e.keyCode]=!0;break;case 32:if(e.preventDefault(),!tt[e.keyCode]&&(qe||Xe)){Ae.flip=!Ae.flip,Ae.scale*=-1,qe=!1;const e=sfxr.generate("jump");e.sound_vol=.1,sfxr.play(e)}tt[e.keyCode]=!0}},It=e=>{if(e.target==document.body)switch(e.keyCode){case 16:case 65:case 68:case 82:case 83:case 87:case 32:tt[e.keyCode]=!1}}}},e=>{e(e.s=316)}]);